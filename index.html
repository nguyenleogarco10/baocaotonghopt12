<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo Cáo Tài Chính Chiến Lược - T12/2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Premium Font Stack -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Space Grotesk', 'sans-serif'],
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' },
                        // Desaturated Luxury Palette
                        indigo: { 
                            500: '#6366f1', 
                            600: '#4f46e5',
                            900: '#312e81',
                            'muted': '#818cf8' 
                        },
                        emerald: {
                            'luxury': '#10b981', // Keeping it slightly vibrant for positive KPI
                            'muted': '#6ee7b7'
                        }
                    },
                    boxShadow: {
                        // 3-Layer Luxury Shadow
                        'luxury': '0 1px 2px rgba(15,23,42,0.04), 0 8px 20px rgba(15,23,42,0.06), inset 0 1px 0 rgba(255,255,255,0.6)',
                        'luxury-hover': '0 20px 40px -10px rgba(15,23,42,0.1), 0 10px 20px -5px rgba(15,23,42,0.04), inset 0 1px 0 rgba(255,255,255,0.8)',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)'
                    },
                    animation: {
                        'blob': 'blob 20s infinite', // Slower animation
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; color: #1e293b; }
        .chart-container { position: relative; height: 320px; width: 100%; }
        .daily-chart-container { position: relative; height: 380px; width: 100%; }
        /* Dynamic height handled by JS, min-height set here */
        .product-chart-container { position: relative; min-height: 400px; width: 100%; }
        
        /* Glassmorphism Refined */
        .glass-card { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-top: 1px solid rgba(255, 255, 255, 0.8);
        }

        .nav-btn-active { 
            background-color: #0f172a !important; 
            color: white !important; 
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.15); 
            border-color: transparent !important;
        }
        
        .transition-luxury { transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        
        /* Thin Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
    </style>
</head>
<body class="pb-20 antialiased selection:bg-indigo-100 selection:text-indigo-900 overflow-x-hidden">

    <!-- Top Strategic Bar -->
    <div class="w-full bg-white border-b border-slate-100 py-2">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
            <p class="font-mono text-[10px] uppercase tracking-[0.2em] text-slate-400 font-bold">Báo cáo Tài chính Chiến lược • Tháng 12/2025</p>
            <div class="flex items-center space-x-2">
                <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                <span class="font-mono text-[10px] uppercase tracking-widest text-slate-400">Kết nối trực tiếp</span>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200/60 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center h-20">
                <div class="flex items-center space-x-8">
                    <!-- Logo Section -->
                    <div class="flex items-center">
                        <img src="1.png" alt="Company Logo" class="h-16 w-auto object-contain"> 
                    </div>
                    
                    <!-- View Mode Toggle -->
                    <div class="hidden md:flex items-center bg-slate-100/80 rounded-full p-1 border border-slate-200">
                        <button onclick="setViewMode('executive')" id="btn-view-exec" class="px-5 py-1.5 rounded-full text-[11px] font-bold uppercase tracking-wide transition-all bg-white shadow-sm text-slate-800 border border-slate-200/50">Tổng Quan</button>
                        <button onclick="setViewMode('analyst')" id="btn-view-analyst" class="px-5 py-1.5 rounded-full text-[11px] font-bold uppercase tracking-wide transition-all text-slate-400 hover:text-slate-600">Chi Tiết</button>
                    </div>
                </div>

                <div class="flex space-x-2 mt-4 md:mt-0 overflow-x-auto w-full md:w-auto pb-2 md:pb-0 scrollbar-hide">
                    <button onclick="filterBrand('all')" id="btn-all" class="nav-btn px-4 py-2 rounded-lg text-[11px] font-bold uppercase tracking-wider bg-white border border-slate-200 text-slate-500 hover:bg-slate-50 transition-luxury nav-btn-active">Tổng Hệ Thống</button>
                    <button onclick="filterBrand('Phục Linh')" id="btn-phuc-linh" class="nav-btn px-4 py-2 rounded-lg text-[11px] font-bold uppercase tracking-wider bg-white border border-slate-200 text-slate-500 hover:bg-slate-50 transition-luxury">Phục Linh</button>
                    <button onclick="filterBrand('An Nhiên')" id="btn-an-nhien" class="nav-btn px-4 py-2 rounded-lg text-[11px] font-bold uppercase tracking-wider bg-white border border-slate-200 text-slate-500 hover:bg-slate-50 transition-luxury">An Nhiên</button>
                    <button onclick="filterBrand('An Nguyên')" id="btn-an-nguyen" class="nav-btn px-4 py-2 rounded-lg text-[11px] font-bold uppercase tracking-wider bg-white border border-slate-200 text-slate-500 hover:bg-slate-50 transition-luxury">An Nguyên</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-slate-50 py-20 px-6 mb-12 overflow-hidden border-b border-slate-200">
        <!-- Subtle Animated Background -->
        <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-indigo-200/20 rounded-full mix-blend-multiply filter blur-[100px] animate-blob"></div>
        <div class="absolute -bottom-32 -left-32 w-[400px] h-[400px] bg-emerald-100/40 rounded-full mix-blend-multiply filter blur-[80px] animate-blob animation-delay-2000"></div>

        <div class="max-w-7xl mx-auto relative z-10 animate-fade-in-up">
            <div class="flex flex-col lg:flex-row justify-between items-end">
                <div class="max-w-4xl">
                    <!-- Editorial Typography -->
                    <h1 id="main-headline" class="font-display text-4xl md:text-[52px] leading-[1.05] font-bold tracking-tight text-slate-900 mb-6">
                        Tháng 12 đạt <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500">4,616,491,200 VND</span><br>Tăng trưởng tập trung nhóm Key Accounts.
                    </h1>
                    
                    <p id="sub-headline" class="font-sans text-slate-500 text-lg md:text-xl font-light leading-relaxed max-w-2xl border-l-2 border-indigo-500 pl-6">
                        Dữ liệu xác thực cho thấy Phục Linh chiếm ưu thế tuyệt đối (72%), trong khi An Nguyên đạt hiệu suất vận hành trên mỗi điểm bán tốt nhất hệ thống.
                    </p>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 lg:px-8 -mt-8">
        
        <!-- 1. Smart KPIs: Insight Driven (Luxury Cards) -->
        <div id="summary-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16 relative z-20">
            <!-- Dynamic Content -->
        </div>

        <!-- 2. Strategic Narrative Charts -->
        <div id="executive-charts" class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8 animate-fade-in-up" style="animation-delay: 0.2s;">
            <!-- Revenue Mix -->
            <div class="lg:col-span-1 glass-card p-8 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury transform hover:-translate-y-1">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h3 class="font-display text-lg font-bold text-slate-800">Cơ Cấu Doanh Thu</h3>
                        <p class="font-sans text-[11px] text-slate-400 mt-1 uppercase tracking-wide">Phân bổ nguồn tiền</p>
                    </div>
                </div>
                <div class="chart-container" style="height: 240px;">
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="mt-8 pt-6 border-t border-slate-100">
                    <div class="flex items-start space-x-3">
                        <div class="w-1 h-8 bg-indigo-500 rounded-full mt-1"></div>
                        <div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">NHẬN ĐỊNH</p>
                            <p id="revenue-insight" class="font-sans text-sm text-slate-700 font-medium leading-snug">Phục Linh chi phối 72% tổng doanh thu. Rủi ro tập trung cao.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operational Trend -->
            <div class="lg:col-span-2 glass-card p-8 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury transform hover:-translate-y-1">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h3 class="font-display text-lg font-bold text-slate-800">Nhịp Điệu Vận Hành</h3>
                        <p class="font-sans text-[11px] text-slate-400 mt-1 uppercase tracking-wide">Biến động lượng khách tuần hoàn</p>
                    </div>
                    <div class="flex items-center space-x-2 bg-slate-50 px-3 py-1 rounded-full border border-slate-100">
                        <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                        <span class="font-mono text-[10px] font-bold text-slate-500">XU HƯỚNG THỰC</span>
                    </div>
                </div>
                <div class="daily-chart-container" style="height: 320px;">
                    <canvas id="dailyGuestChart"></canvas>
                </div>
            </div>
        </div>

        <!-- NEW: Product Performance Chart Section (Dynamic Injection) -->
        <div id="product-chart-area" class="grid grid-cols-1 mb-16 animate-fade-in-up" style="animation-delay: 0.3s;">
            <!-- Content will be injected here by JS -->
        </div>

        <!-- 3. Analyst View Details (Hidden by default) -->
        <div id="analyst-section" class="hidden opacity-0 transition-opacity duration-700 ease-in-out">
            <div class="flex items-center space-x-4 mb-8">
                <h3 class="font-display text-xl font-bold text-slate-900">Chi Tiết Vận Hành (Chế độ Phân tích)</h3>
                <div class="h-px flex-1 bg-slate-200"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                <!-- Guest Comparison Bar -->
                <div class="glass-card p-8 rounded-[24px] shadow-luxury">
                    <h4 class="font-display font-bold text-slate-700 mb-6">So Sánh Lượng Khách</h4>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="guestChart"></canvas>
                    </div>
                </div>

                <!-- Detailed Table -->
                <div class="glass-card rounded-[24px] shadow-luxury overflow-hidden border border-white">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-50/80 text-slate-500 font-mono text-[10px] uppercase tracking-wider font-semibold border-b border-slate-100">
                            <tr>
                                <th class="p-5 pl-8">Cơ sở</th>
                                <th class="p-5 text-center">Ngày Đông Nhất</th>
                                <th class="p-5 text-right">Khách Tối Đa</th>
                                <th class="p-5 text-right pr-8">TBB (VNĐ)</th>
                            </tr>
                        </thead>
                        <tbody id="detail-table-body" class="divide-y divide-slate-50 font-mono text-xs text-slate-600">
                            <!-- JS Inject -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 4. Key Takeaways: CEO Box -->
        <div id="key-takeaways" class="glass-card p-10 rounded-[32px] shadow-2xl bg-slate-900 text-white mb-20 relative overflow-hidden group">
            <!-- Ambient Glow -->
            <div class="absolute top-0 right-0 p-40 bg-indigo-500/20 rounded-full blur-[100px] transform translate-x-1/2 -translate-y-1/2 transition-all duration-1000 group-hover:bg-indigo-500/30"></div>
            <div class="absolute bottom-0 left-0 p-32 bg-emerald-500/10 rounded-full blur-[80px] transform -translate-x-1/2 translate-y-1/2"></div>
            
            <div class="relative z-10">
                <div class="flex items-center space-x-3 mb-8">
                    <div class="p-2 bg-white/10 rounded-lg backdrop-blur-sm">
                        <svg class="w-5 h-5 text-yellow-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <h3 class="font-display text-xl font-bold tracking-tight">TÓM TẮT ĐIỀU HÀNH</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div class="space-y-6">
                        <div class="flex items-start group/item">
                            <span class="font-mono text-emerald-400 font-bold mr-4 text-sm mt-1 group-hover/item:text-emerald-300 transition-colors">01</span>
                            <div>
                                <h4 class="font-display font-bold text-lg text-white mb-1">Phục Linh là trụ cột (Cash Cow)</h4>
                                <p class="font-sans text-sm text-slate-400 leading-relaxed font-light">Đóng góp <strong class="text-white font-medium">72% doanh thu</strong> toàn hệ thống. Cần chính sách giữ chân khách hàng VIP tại Xã Đàn & Cầu Giấy để bảo vệ dòng tiền.</p>
                            </div>
                        </div>
                        <div class="flex items-start group/item">
                            <span class="font-mono text-yellow-400 font-bold mr-4 text-sm mt-1 group-hover/item:text-yellow-300 transition-colors">02</span>
                            <div>
                                <h4 class="font-display font-bold text-lg text-white mb-1">Điểm nghẽn giá trị tại An Nhiên</h4>
                                <p class="font-sans text-sm text-slate-400 leading-relaxed font-light">TBB thấp hơn <strong class="text-white font-medium">32%</strong> so với mức trung bình. Cần gói dịch vụ Up-sell mới cho phân khúc này.</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="flex items-start group/item">
                            <span class="font-mono text-indigo-400 font-bold mr-4 text-sm mt-1 group-hover/item:text-indigo-300 transition-colors">03</span>
                            <div>
                                <h4 class="font-display font-bold text-lg text-white mb-1">An Nguyên: Mô hình hiệu suất cao</h4>
                                <p class="font-sans text-sm text-slate-400 leading-relaxed font-light">Chỉ 1 cơ sở nhưng lượng khách ngang ngửa top Phục Linh. Mô hình tinh gọn <strong class="text-white font-medium">cần nhân rộng (Scalable)</strong>.</p>
                            </div>
                        </div>
                        <div class="flex items-start group/item">
                            <span class="font-mono text-pink-400 font-bold mr-4 text-sm mt-1 group-hover/item:text-pink-300 transition-colors">04</span>
                            <div>
                                <h4 class="font-display font-bold text-lg text-white mb-1">Cảnh báo vận hành cuối tuần</h4>
                                <p class="font-sans text-sm text-slate-400 leading-relaxed font-light">Chủ Nhật là Ngày Cao Điểm tại 50% cơ sở. Cần phương án điều phối nhân sự linh hoạt để đảm bảo trải nghiệm khách hàng.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="flex justify-between items-center pt-8 border-t border-slate-200">
            <p class="font-mono text-[10px] text-slate-400 uppercase tracking-widest">Tài liệu mật • Chỉ lưu hành nội bộ</p>
            <p class="font-mono text-[10px] text-slate-400">Hệ thống v2.4 • Được tạo bởi FinanceHub</p>
        </footer>

    </main>

    <script>
        // --- DATA LAYER (UNCHANGED) ---
        const rawData = [
            { brand: 'Phục Linh', branch: 'Xã Đàn', guests: 220, revenue: 1064449000, tbb: 4838405, peakDay: 'Thứ Hai', peakGuests: 41 },
            { brand: 'Phục Linh', branch: 'Cầu Giấy', guests: 194, revenue: 941188000, tbb: 4851485, peakDay: 'Thứ Tư', peakGuests: 35 },
            { brand: 'Phục Linh', branch: 'Hà Đông', guests: 195, revenue: 860443000, tbb: 4412528, peakDay: 'Thứ Bảy', peakGuests: 33 },
            { brand: 'Phục Linh', branch: 'Hải Phòng', guests: 163, revenue: 443440500, tbb: 2720494, peakDay: 'Chủ Nhật', peakGuests: 36 },
            { brand: 'An Nhiên', branch: 'CMT8', guests: 99, revenue: 295630000, tbb: 2986162, peakDay: 'Thứ Sáu', peakGuests: 17 },
            { brand: 'An Nhiên', branch: 'ADV', guests: 112, revenue: 264500700, tbb: 2361613, peakDay: 'Chủ Nhật', peakGuests: 25 },
            { brand: 'An Nguyên', branch: 'Long Biên', guests: 207, revenue: 746840000, tbb: 3607923, peakDay: 'Thứ Ba', peakGuests: 46 }
        ];

        const dailyData = {
            'all': [189, 200, 177, 146, 131, 165, 182],
            'Phục Linh': [120, 121, 118, 100, 81, 107, 125],
            'An Nhiên': [35, 33, 31, 21, 31, 28, 32],
            'An Nguyên': [34, 46, 28, 25, 19, 30, 25]
        };

        // --- REAL PRODUCT DATA ---
        // Extracted & Processed from TongHop.csv
        // Structure: All > Brand > Branch (if applicable)
        const productData = {
          "all": {
            "labels": ["SP50", "SP18", "SP78", "SP51", "SP20", "SP19", "SP75", "SP79", "SP74", "SP24", "SP76", "SP21", "SP77", "HH10", "SP15", "SP17", "SP25"],
            "data": [2319, 194, 164, 125, 81, 46, 16, 14, 14, 12, 11, 8, 2, 2, 1, 1, 1]
          },
          "An Nhiên": {
            "labels": ["SP18", "SP17", "SP20", "SP24"],
            "data": [4, 1, 1, 1],
            "branches": [
                {
                    "name": "An Nhiên - ADV",
                    "labels": ["SP18", "SP20", "SP24"],
                    "data": [4, 1, 1]
                },
                {
                    "name": "An Nhiên - CMT8",
                    "labels": ["SP17"],
                    "data": [1]
                }
            ]
          },
          "An Nguyên": {
            "labels": ["SP18", "SP24", "SP20", "SP21", "HH10", "SP15", "SP25"],
            "data": [188, 11, 10, 6, 2, 1, 1],
            "branches": [
                {
                    "name": "An Nguyên - Long Biên",
                    "labels": ["SP18", "SP24", "SP20", "SP21", "HH10", "SP15", "SP25"],
                    "data": [188, 11, 10, 6, 2, 1, 1]
                }
            ]
          },
          "Phục Linh": {
            "labels": ["SP50", "SP78", "SP51", "SP20", "SP19", "SP75", "SP74", "SP79", "SP76", "SP18", "SP21", "SP77"],
            "data": [2319, 164, 125, 70, 46, 16, 14, 14, 11, 2, 2, 2],
            "branches": [
                {
                    "name": "Phục Linh - Xã Đàn",
                    "labels": ["SP50", "SP78", "SP51", "SP19", "SP74", "SP75", "SP20", "SP76", "SP18", "SP77", "SP79"],
                    "data": [783, 40, 19, 12, 10, 10, 9, 9, 1, 1, 1]
                },
                {
                    "name": "Phục Linh - Cầu Giấy",
                    "labels": ["SP50", "SP78", "SP51", "SP20", "SP75", "SP79", "SP19", "SP21", "SP77"],
                    "data": [588, 101, 46, 12, 6, 5, 4, 1, 1]
                },
                {
                    "name": "Phục Linh - Hà Đông",
                    "labels": ["SP50", "SP20", "SP19", "SP78", "SP79", "SP74", "SP76", "SP21"],
                    "data": [889, 41, 22, 13, 6, 3, 2, 1]
                },
                {
                    "name": "Phục Linh - Hải Phòng",
                    "labels": ["SP51", "SP50", "SP78", "SP19", "SP20", "SP79", "SP18", "SP74"],
                    "data": [60, 59, 10, 8, 8, 2, 1, 1]
                }
            ]
          }
        };

        const SYSTEM_TOTAL_REV = 4616491200;
        const SYSTEM_AVG_TBB = 3879400;

        let revenueChart, dailyGuestChart, guestChart;
        let productCharts = []; // Array to store multiple product charts

        // --- UI LOGIC ---

        function setViewMode(mode) {
            const analystSection = document.getElementById('analyst-section');
            const btnExec = document.getElementById('btn-view-exec');
            const btnAnalyst = document.getElementById('btn-view-analyst');

            if (mode === 'executive') {
                analystSection.classList.add('hidden', 'opacity-0');
                analystSection.classList.remove('block', 'opacity-100');
                
                // Toggle Styles
                btnExec.classList.add('bg-white', 'shadow-sm', 'text-slate-800', 'border-slate-200/50');
                btnExec.classList.remove('text-slate-400');
                
                btnAnalyst.classList.remove('bg-white', 'shadow-sm', 'text-slate-800', 'border-slate-200/50');
                btnAnalyst.classList.add('text-slate-400');
            } else {
                analystSection.classList.remove('hidden');
                setTimeout(() => analystSection.classList.remove('opacity-0'), 20);
                
                btnAnalyst.classList.add('bg-white', 'shadow-sm', 'text-slate-800', 'border-slate-200/50');
                btnAnalyst.classList.remove('text-slate-400');

                btnExec.classList.remove('bg-white', 'shadow-sm', 'text-slate-800', 'border-slate-200/50');
                btnExec.classList.add('text-slate-400');
                
                analystSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function filterBrand(brand) {
            const filteredData = brand === 'all' ? rawData : rawData.filter(d => d.brand === brand);
            updateUI(filteredData, brand);
            
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('nav-btn-active', 'bg-slate-900', 'text-white');
                b.classList.add('bg-white', 'text-slate-500');
            });
            
            const btnId = brand === 'all' ? 'btn-all' : 'btn-' + brand.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '-');
            const activeBtn = document.getElementById(btnId);
            activeBtn.classList.add('nav-btn-active');
            activeBtn.classList.remove('bg-white', 'text-slate-500');
        }

        function updateUI(data, brandName) {
            const totalRev = data.reduce((s, d) => s + d.revenue, 0);
            const totalGuests = data.reduce((s, d) => s + d.guests, 0);
            const avgTbb = Math.round(totalRev / totalGuests);

            if (brandName === 'all') {
                document.getElementById('main-headline').innerHTML = `Tháng 12 đạt <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500">${totalRev.toLocaleString()} VND</span><br>Tăng trưởng tập trung nhóm Key Accounts.`;
                document.getElementById('sub-headline').innerText = "Dữ liệu xác thực cho thấy Phục Linh chiếm ưu thế tuyệt đối (72%), trong khi An Nguyên đạt hiệu suất vận hành trên mỗi điểm bán tốt nhất hệ thống.";
            } else if (brandName === 'Phục Linh') {
                document.getElementById('main-headline').innerHTML = `Phục Linh: <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-500">${totalRev.toLocaleString()} VND</span><br>Chiếm lĩnh 72% thị phần hệ thống.`;
                document.getElementById('sub-headline').innerText = "Cơ sở Xã Đàn và Cầu Giấy đang dẫn đầu về hiệu suất tài chính (TBB > 4.8M), đóng vai trò Cash Cow.";
            } else if (brandName === 'An Nhiên') {
                document.getElementById('main-headline').innerHTML = `An Nhiên: <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-500 to-yellow-500">${totalRev.toLocaleString()} VND</span><br>Tiềm năng tối ưu hóa giá trị đơn hàng.`;
                document.getElementById('sub-headline').innerText = "TBB hiện tại thấp hơn mức trung bình hệ thống, đây là dư địa tăng trưởng lớn nhất cho Q1/2026.";
            } else {
                document.getElementById('main-headline').innerHTML = `An Nguyên: <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-indigo-400">MÔ HÌNH HIỆU QUẢ CAO</span><br>1 cơ sở tạo ra doanh thu ngang Top 3.`;
                document.getElementById('sub-headline').innerText = "Long Biên chứng minh hiệu quả vận hành vượt trội với lượng khách ổn định và chi phí tối ưu.";
            }

            let revShare = ((totalRev / SYSTEM_TOTAL_REV) * 100).toFixed(1);
            let tbbDiff = ((avgTbb - SYSTEM_AVG_TBB) / SYSTEM_AVG_TBB * 100).toFixed(1);
            let tbbColor = tbbDiff >= 0 ? 'text-emerald-luxury' : 'text-red-500';
            let tbbBg = tbbDiff >= 0 ? 'bg-emerald-50' : 'bg-red-50';
            let tbbIcon = tbbDiff >= 0 ? '▲' : '▼';

            document.getElementById('summary-stats').innerHTML = `
                <div class="glass-card p-6 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury hover:scale-[1.02] cursor-default border-l-4 border-indigo-600">
                    <p class="font-sans text-[10px] font-bold text-slate-400 uppercase tracking-[0.18em] mb-2">Tổng Doanh Thu</p>
                    <div class="flex items-baseline space-x-1">
                        <p class="font-mono text-[24px] font-bold text-slate-800 tracking-tighter">${totalRev.toLocaleString()}</p>
                        <span class="font-sans text-sm text-slate-400 font-medium">VND</span>
                    </div>
                    <div class="mt-3 flex items-center">
                         <span class="px-2 py-1 bg-indigo-50 text-indigo-700 text-[10px] font-bold uppercase tracking-wider rounded border border-indigo-100">
                            Đóng góp ${revShare}%
                         </span>
                    </div>
                </div>
                <div class="glass-card p-6 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury hover:scale-[1.02] cursor-default border-l-4 border-emerald-500">
                    <p class="font-sans text-[10px] font-bold text-slate-400 uppercase tracking-[0.18em] mb-2">Tổng Lượt Khách</p>
                    <div class="flex items-baseline space-x-1">
                        <p class="font-mono text-[24px] font-bold text-slate-800 tracking-tighter">${totalGuests.toLocaleString()}</p>
                        <span class="font-sans text-sm text-slate-400 font-medium">Khách</span>
                    </div>
                    <div class="mt-3 flex items-center">
                         <span class="px-2 py-1 bg-emerald-50 text-emerald-700 text-[10px] font-bold uppercase tracking-wider rounded border border-emerald-100">
                            Lưu lượng ổn định
                         </span>
                    </div>
                </div>
                <div class="glass-card p-6 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury hover:scale-[1.02] cursor-default border-l-4 border-amber-400">
                    <p class="font-sans text-[10px] font-bold text-slate-400 uppercase tracking-[0.18em] mb-2">Giá Trị Bill TB (TBB)</p>
                    <div class="flex items-baseline space-x-1">
                        <p class="font-mono text-[24px] font-bold text-slate-800 tracking-tighter">${avgTbb.toLocaleString()}</p>
                        <span class="font-sans text-sm text-slate-400 font-medium">VND</span>
                    </div>
                    <div class="mt-3 flex items-center">
                         <span class="px-2 py-1 ${tbbBg} ${tbbColor} text-[10px] font-bold uppercase tracking-wider rounded border border-slate-100">
                            ${tbbIcon} ${Math.abs(tbbDiff)}% so với TB hệ thống
                         </span>
                    </div>
                </div>
                <div class="glass-card p-6 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury hover:scale-[1.02] cursor-default border-l-4 border-slate-400">
                    <p class="font-sans text-[10px] font-bold text-slate-400 uppercase tracking-[0.18em] mb-2">Hiệu Suất Vận Hành</p>
                    <div class="flex items-baseline space-x-1">
                        <p class="font-mono text-[24px] font-bold text-slate-800 tracking-tighter">${Math.round(totalGuests/data.length)}</p>
                        <span class="font-sans text-sm text-slate-400 font-medium">Khách / Cơ sở</span>
                    </div>
                    <div class="mt-3 flex items-center">
                         <span class="px-2 py-1 bg-slate-100 text-slate-600 text-[10px] font-bold uppercase tracking-wider rounded border border-slate-200">
                            Tải vận hành
                         </span>
                    </div>
                </div>
            `;

            let tableHTML = '';
            data.forEach(d => {
                tableHTML += `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-5 pl-8 font-sans font-semibold text-slate-700 border-r border-slate-100/50">${d.branch}</td>
                        <td class="p-5 text-center text-indigo-600 font-bold">
                            <span class="bg-indigo-50 px-3 py-1 rounded-full text-[11px] uppercase tracking-wide">${d.peakDay}</span>
                        </td>
                        <td class="p-5 text-right font-mono text-slate-600">${d.peakGuests}</td>
                        <td class="p-5 pr-8 text-right font-mono font-bold text-emerald-600">${d.tbb.toLocaleString()}</td>
                    </tr>
                `;
            });
            document.getElementById('detail-table-body').innerHTML = tableHTML;

            updateCharts(data, brandName);
        }

        function updateCharts(data, brandName) {
            if (revenueChart) revenueChart.destroy();
            if (dailyGuestChart) dailyGuestChart.destroy();
            if (guestChart) guestChart.destroy();
            
            // Destroy existing product charts
            productCharts.forEach(c => c.destroy());
            productCharts = [];

            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.scale.grid.color = '#f1f5f9';

            // 1. Revenue Chart
            let chart1Labels, chart1Data;
            if (brandName === 'all') {
                chart1Labels = ['Phục Linh', 'An Nhiên', 'An Nguyên'];
                chart1Data = [3309520500, 560130700, 746840000];
            } else {
                chart1Labels = data.map(d => d.branch);
                chart1Data = data.map(d => d.revenue);
            }

            revenueChart = new Chart(document.getElementById('revenueChart'), {
                type: 'doughnut',
                data: {
                    labels: chart1Labels,
                    datasets: [{
                        data: chart1Data,
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b', '#ec4899', '#8b5cf6'],
                        borderWidth: 0,
                        hoverOffset: 12
                    }]
                },
                options: { 
                    maintainAspectRatio: false, 
                    cutout: '80%',
                    animation: { animateScale: true, animateRotate: true },
                    plugins: { 
                        legend: { position: 'right', labels: { usePointStyle: true, pointStyle: 'circle', padding: 20, font: { size: 11, family: 'Inter', weight: '500' }, color: '#475569' } },
                        tooltip: { backgroundColor: '#1e293b', padding: 16, cornerRadius: 8, titleFont: {family: 'Space Grotesk'}, bodyFont: {family: 'JetBrains Mono'}, displayColors: false, callbacks: { label: (c) => `  ${c.label}: ${c.parsed.toLocaleString()} VND` } }
                    } 
                }
            });

            // 2. Daily Guest Chart
            const currentDailyData = dailyData[brandName] || dailyData['all'];
            const ctxDaily = document.getElementById('dailyGuestChart').getContext('2d');
            const gradient = ctxDaily.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.15)'); 
            gradient.addColorStop(1, 'rgba(16, 185, 129, 0.0)');

            dailyGuestChart = new Chart(ctxDaily, {
                type: 'line',
                data: {
                    labels: ['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7', 'CN'],
                    datasets: [{
                        label: 'Guests',
                        data: currentDailyData,
                        borderColor: '#10b981',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#10b981',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 8,
                        pointHoverBorderWidth: 3,
                        fill: true,
                        tension: 0.45
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { borderDash: [4, 4], drawBorder: false }, ticks: { display: false } },
                        x: { grid: { display: false }, ticks: { font: { family: 'Inter', size: 11 }, color: '#94a3b8' } }
                    },
                    plugins: { 
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: '#0f172a', 
                            titleFont: { family: 'Space Grotesk', size: 12 },
                            bodyFont: { family: 'JetBrains Mono', size: 14 },
                            padding: 14,
                            cornerRadius: 6,
                            displayColors: false,
                            intersect: false,
                            mode: 'index',
                            callbacks: { label: (c) => `Lượt khách: ${c.parsed.y}` }
                        }
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });

            // 3. PRODUCT CHARTS (Dynamic Injection for multiple branches)
            const productChartArea = document.getElementById('product-chart-area');
            productChartArea.innerHTML = ''; // Clear previous

            if (brandName === 'all') {
                // Show 1 big chart for All
                const html = `
                    <div class="glass-card p-8 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury transform hover:-translate-y-1 border-l-4 border-indigo-500">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="font-display text-lg font-bold text-slate-800">Toàn Bộ Danh Mục Sản Phẩm (Hệ Thống)</h3>
                                <p class="font-sans text-[11px] text-slate-400 mt-1 uppercase tracking-wide">Tổng hợp số lượng bán ra</p>
                            </div>
                        </div>
                        <div class="product-chart-container" id="container-all" style="height: 500px;">
                            <canvas id="productChart-all"></canvas>
                        </div>
                    </div>`;
                productChartArea.insertAdjacentHTML('beforeend', html);
                
                const ctx = document.getElementById('productChart-all');
                createProductChart(ctx, productData['all'].labels, productData['all'].data);

            } else {
                // Show multiple charts for branches
                const brandInfo = productData[brandName];
                if (brandInfo && brandInfo.branches) {
                    // Grid layout for multiple charts if needed, or stacked vertical
                    productChartArea.className = "grid grid-cols-1 gap-8 mb-16 animate-fade-in-up";
                    
                    brandInfo.branches.forEach((branch, index) => {
                        const canvasId = `productChart-${index}`;
                        const containerId = `container-${index}`;
                        // Calculate height based on items
                        const height = Math.max(250, branch.labels.length * 35); 

                        const html = `
                            <div class="glass-card p-8 rounded-[24px] shadow-luxury hover:shadow-luxury-hover transition-luxury transform hover:-translate-y-1 border-l-4 border-indigo-500">
                                <div class="flex justify-between items-start mb-6">
                                    <div>
                                        <h3 class="font-display text-lg font-bold text-slate-800">${branch.name}</h3>
                                        <p class="font-sans text-[11px] text-slate-400 mt-1 uppercase tracking-wide">Chi tiết mã hàng bán ra</p>
                                    </div>
                                </div>
                                <div class="product-chart-container" id="${containerId}" style="height: ${height}px;">
                                    <canvas id="${canvasId}"></canvas>
                                </div>
                            </div>`;
                        productChartArea.insertAdjacentHTML('beforeend', html);
                        
                        const ctx = document.getElementById(canvasId);
                        createProductChart(ctx, branch.labels, branch.data);
                    });
                }
            }

            // 4. Guest Bar (Analyst)
            guestChart = new Chart(document.getElementById('guestChart'), {
                type: 'bar',
                data: {
                    labels: data.map(d => d.branch),
                    datasets: [{
                        label: 'Guests',
                        data: data.map(d => d.guests),
                        backgroundColor: '#e2e8f0', 
                        hoverBackgroundColor: '#4f46e5',
                        borderRadius: 4,
                        barThickness: 40
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false }, ticks: { font: { family: 'Inter', size: 11 } } } } }
            });
        }

        function createProductChart(ctx, labels, data) {
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Số lượng bán',
                        data: data,
                        backgroundColor: '#6366f1',
                        borderRadius: 4,
                        barThickness: 15
                    }]
                },
                options: {
                    indexAxis: 'y',
                    maintainAspectRatio: false,
                    scales: {
                        x: { beginAtZero: true, grid: { borderDash: [4, 4] } },
                        y: { grid: { display: false }, ticks: { font: { family: 'Inter', size: 11, weight: '500' }, color: '#475569' } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            padding: 12,
                            cornerRadius: 6,
                            callbacks: { label: (c) => `  Đã bán: ${c.parsed.x}` }
                        }
                    }
                }
            });
            productCharts.push(chart);
        }

        window.onload = () => filterBrand('all');
    </script>
</body>
</html>
