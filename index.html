<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard An Nhi√™n 2026 - Premium</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Zen Font Stack -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Quicksand', 'sans-serif'],
                        sans: ['Nunito', 'sans-serif'],
                    },
                    colors: {
                        zen: {
                            bg: '#F7F5F2',
                            card: '#FAFAF8',
                            sage: '#8FAF9F',
                            tea: '#6B8F71',
                            dark: '#3F3F3F',
                            wood: '#CBBFA3',
                            gray: '#E5E5E5',
                            red: '#DFA7A7',
                            gold: '#D4AF37'
                        }
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F7F5F2; color: #3F3F3F; }
        
        /* Utils */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #E5E5E5; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #CBBFA3; }

        /* Sidebar Item */
        .sidebar-item { position: relative; transition: color 0.3s ease; z-index: 1; overflow: hidden; }
        .sidebar-item::before {
            content: ''; position: absolute; top: 0; left: 0; width: 0%; height: 100%;
            background-color: #FAFAF8; z-index: -1; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sidebar-item:hover::before { width: 100%; }
        .sidebar-item.active { color: #6B8F71; font-weight: 700; background-color: #FAFAF8; }
        .sidebar-item.active::after {
            content: ''; position: absolute; right: 0; top: 50%; transform: translateY(-50%);
            width: 4px; height: 20px; background-color: #6B8F71;
            border-top-left-radius: 4px; border-bottom-left-radius: 4px;
        }

        /* Animations */
        .reveal-on-scroll { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.5, 0, 0, 1); }
        .reveal-on-scroll.is-visible { opacity: 1; transform: translateY(0); }
        
        .progress-bar-bg { background-color: #F0F0F0; border-radius: 999px; overflow: hidden; height: 10px; position: relative; }
        .progress-bar-fill { height: 100%; border-radius: 999px; width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); }
        
        /* Breakeven Marker */
        .breakeven-marker {
            position: absolute;
            top: -4px;
            bottom: -4px;
            width: 2px;
            background-color: #3F3F3F; 
            z-index: 10;
        }
        .breakeven-label {
            position: absolute;
            top: -20px;
            transform: translateX(-50%);
            font-size: 9px;
            color: #3F3F3F;
            font-weight: bold;
            white-space: nowrap;
        }

        /* Top 1 Card */
        .card-top-1 {
            border: 2px solid rgba(212, 175, 55, 0.3);
            background: linear-gradient(145deg, #fffcf5 0%, #ffffff 100%);
            box-shadow: 0 20px 25px -5px rgba(212, 175, 55, 0.15);
            transform: translateY(-4px); position: relative;
        }
        .card-top-1::before {
            content: 'üëë'; position: absolute; top: -15px; right: 20px; font-size: 24px;
            animation: float 3s ease-in-out infinite; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        .card-hover { transition: all 0.3s ease; will-change: transform, box-shadow; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.08); }

        /* Consultant Box */
        .consultant-box {
            background: linear-gradient(135deg, #fdfbf7 0%, #fff 100%);
            border-left: 4px solid #D4AF37;
        }
    </style>

<style>
/* ===== SAFE Marketing Funnel Layout ===== */
#marketingContainer {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  margin-top: 16px;
}

.marketing-funnel-card {
  border: 1px solid #eee;
  border-radius: 14px;
  padding: 18px 20px;
  background: #fff;
}

.marketing-funnel-title {
  font-weight: 600;
  text-align: center;
  margin-bottom: 14px;
}

.marketing-funnel-steps {
  display: grid;
  grid-template-columns: 1fr auto 1fr auto 1fr;
  align-items: center;
  gap: 8px;
}

.marketing-funnel-step {
  text-align: center;
}

.marketing-funnel-step .label {
  font-size: 13px;
  color: #777;
}

.marketing-funnel-step .value {
  font-size: 22px;
  font-weight: 600;
  margin-top: 4px;
}

.marketing-funnel-arrow {
  font-size: 18px;
  color: #bbb;
}

.marketing-funnel-rate {
  display: flex;
  justify-content: space-between;
  margin-top: 12px;
  font-size: 13px;
  color: #555;
}
</style>

</head>
<body class="font-sans h-screen flex overflow-hidden text-zen-dark bg-zen-bg">

    <!-- SIDEBAR -->
    <aside class="w-64 bg-white border-r border-zen-gray flex-col hidden md:flex z-20 shadow-sm relative">
        <div class="p-8 pb-4">
            <h1 class="font-display text-2xl font-bold text-zen-tea flex items-center gap-2">
                <i data-lucide="flower-2"></i> An Nhi√™n
            </h1>
            <p class="text-xs text-gray-400 mt-1 pl-8 tracking-wider">ECOSYSTEM 2026</p>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <div class="px-6 mb-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Th∆∞∆°ng Hi·ªáu</div>
            <a href="#" onclick="filterBrand('all')" class="sidebar-item active flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="layout-grid" class="w-4 h-4"></i> T·ªïng H·ª£p
            </a>
            <a href="#" onclick="filterBrand('AN NGUY√äN')" class="sidebar-item flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="sprout" class="w-4 h-4"></i> An Nguy√™n
            </a>
            <a href="#" onclick="filterBrand('AN NHI√äN')" class="sidebar-item flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="sun" class="w-4 h-4"></i> An Nhi√™n
            </a>
            <a href="#" onclick="filterBrand('PH·ª§C LINH')" class="sidebar-item flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="heart-pulse" class="w-4 h-4"></i> Ph·ª•c Linh
            </a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col overflow-hidden relative" id="main-scroll-container">
        
        <!-- HEADER -->
        <header id="main-header" class="bg-white/70 backdrop-blur-sm border-b border-zen-gray px-8 py-4 flex justify-between items-center z-10 sticky top-0 transition-all duration-300">
            <div>
                <h2 class="font-display text-xl font-bold" id="pageTitle">T·ªïng Quan Th√°ng <span id="displayMonth">2</span>/2026</h2>
                <p class="text-xs text-gray-400 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    D·ªØ li·ªáu th·ª±c t·∫ø [T·ª± ƒë·ªông c·∫≠p nh·∫≠t]
                </p>
            </div>
            
            <!-- Month Selector -->
            <div class="flex items-center gap-2 bg-zen-bg p-1 rounded-xl overflow-x-auto hide-scroll max-w-xl border border-zen-gray/50" id="month-selector">
                <!-- Generated by JS -->
            </div>
        </header>

        <!-- DASHBOARD BODY -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 custom-scroll scroll-smooth" id="scroll-body">
            
            <!-- CONSULTANT BOX (DYNAMIC CONTENT) -->
            <div class="mb-8 reveal-on-scroll" style="transition-delay: 0ms;">
                <div class="consultant-box p-6 rounded-2xl shadow-sm border border-zen-gray relative">
                    <div class="absolute top-4 right-4 text-zen-wood opacity-20">
                        <i data-lucide="quote" class="w-16 h-16"></i>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-white p-3 rounded-full shadow-sm border border-zen-gray shrink-0">
                            <i data-lucide="briefcase" class="w-6 h-6 text-zen-gold"></i>
                        </div>
                        <div class="flex-1 z-10">
                            <h3 class="font-display font-bold text-lg text-zen-dark mb-3">G√≥c Nh√¨n Chi·∫øn L∆∞·ª£c</h3>
                            <div class="text-sm text-gray-700 leading-relaxed space-y-3" id="consultant-content">
                                <!-- Content injected by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KPI CARDS -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- KPI 1 -->
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 100ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">Doanh Thu Th·ª±c ƒê·∫°t</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-revenue">0</h3>
                        </div>
                        <div class="p-2 bg-zen-tea/10 rounded-lg text-zen-tea ring-1 ring-zen-tea/20">
                            <i data-lucide="banknote" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
                <!-- KPI 2 -->
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 200ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">T·ªïng L∆∞·ª£ng Kh√°ch</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-customers">0</h3>
                        </div>
                        <div class="p-2 bg-blue-100 rounded-lg text-blue-600 ring-1 ring-blue-600/20">
                            <i data-lucide="users" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
                <!-- KPI 3 -->
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 300ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">Chi Ph√≠ Ads</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-ads">0</h3>
                        </div>
                        <div class="p-2 bg-red-100 rounded-lg text-red-600 ring-1 ring-red-600/20">
                            <i data-lucide="megaphone" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
                <!-- KPI 4 -->
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 400ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">Trung B√¨nh Bill</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-bill">0</h3>
                        </div>
                        <div class="p-2 bg-orange-100 rounded-lg text-orange-600 ring-1 ring-orange-600/20">
                            <i data-lucide="pie-chart" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAIN CHART (Full Width) -->
            <div class="grid grid-cols-1 gap-6 mb-8">
                <!-- CHART -->
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray reveal-on-scroll group" style="transition-delay: 200ms;">
                    <h3 class="font-display font-bold text-lg text-zen-dark mb-6 flex items-center gap-2">
                        <i data-lucide="bar-chart-2" class="w-4 h-4 text-zen-tea"></i>
                        Bi·ªÉu ƒê·ªì Doanh Thu, Kh√°ch & Bill
                    </h3>
                    <div class="h-80 w-full relative transition-transform duration-700 ease-out transform group-hover:scale-[1.01]">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- MARKETING FUNNELS -->
            <div class="mb-10 reveal-on-scroll">
                <div class="flex justify-between items-center mb-6 px-1">
                    <h3 class="font-display font-bold text-lg text-zen-dark flex items-center gap-2">
                        <i data-lucide="filter" class="w-5 h-5 text-zen-tea"></i>
                        Hi·ªáu qu·∫£ Marketing
                    </h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="marketingContainer">
                    <!-- Funnels will be injected here -->
                </div>
            </div>

            <!-- BRANCH DETAILS CARDS -->
            <div class="mb-10">
                <div class="flex justify-between items-center mb-6 px-1 reveal-on-scroll">
                    <h3 class="font-display font-bold text-lg text-zen-dark flex items-center gap-2">
                        <i data-lucide="store" class="w-5 h-5 text-zen-dark"></i>
                        Chi Ti·∫øt Hi·ªáu Qu·∫£ Kinh Doanh
                    </h3>
                    <div class="flex gap-2">
                         <span class="text-xs text-zen-tea bg-white px-3 py-1 rounded-full border border-zen-tea font-bold shadow-sm">Th·ª±c ƒë·∫°t</span>
                         <span class="text-xs text-gray-400 bg-white px-3 py-1 rounded-full border border-zen-gray">Target</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="branchContainer">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- ADS COST TABLE SECTION -->
            <div class="mb-10 reveal-on-scroll">
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-display font-bold text-lg text-zen-dark flex items-center gap-2">
                            <i data-lucide="badge-dollar-sign" class="w-5 h-5 text-red-500"></i>
                            B·∫£ng Chi Ph√≠ Ads & Hi·ªáu Qu·∫£ (CIR)
                        </h3>
                        <span class="text-xs text-gray-400">D·ªØ li·ªáu Ads c·∫≠p nh·∫≠t theo file T·ªïng H·ª£p</span>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full zen-table">
                            <thead>
                                <tr>
                                    <th class="w-10"></th>
                                    <th>C∆° S·ªü</th>
                                    <th class="!text-right">Chi Ph√≠ Ads</th>
                                    <th class="!text-right">Doanh Thu</th>
                                    <th class="!text-right">CIR (%)</th>
                                    <th class="!text-right w-24">ƒê√°nh Gi√°</th>
                                </tr>
                            </thead>
                            <tbody id="adsTableBody">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="h-8"></div>
        </div>
    </main>

    <script>
        // ================= DATA STORE =================
        
        // --- MONTH 1 (JAN) DATA - FULLY CORRECTED ---
        const csvRaw_M1 = `
AN NGUY√äN,LONG BI√äN,2026-01-02,4,19800000,4950000
AN NGUY√äN,LONG BI√äN,2026-01-03,7,4600000,657143
AN NGUY√äN,LONG BI√äN,2026-01-04,10,23900000,2390000
AN NGUY√äN,LONG BI√äN,2026-01-05,12,60300000,5025000
AN NGUY√äN,LONG BI√äN,2026-01-06,4,10199000,2549750
AN NGUY√äN,LONG BI√äN,2026-01-07,6,27300000,4550000
AN NGUY√äN,LONG BI√äN,2026-01-08,10,23200000,2320000
AN NGUY√äN,LONG BI√äN,2026-01-09,6,31400000,5233333
AN NGUY√äN,LONG BI√äN,2026-01-10,7,22600000,3228571
AN NGUY√äN,LONG BI√äN,2026-01-11,1,4800000,4800000
AN NGUY√äN,LONG BI√äN,2026-01-12,7,30400000,4342857
AN NGUY√äN,LONG BI√äN,2026-01-13,3,23500000,7833333
AN NGUY√äN,LONG BI√äN,2026-01-14,4,11600000,2900000
AN NGUY√äN,LONG BI√äN,2026-01-15,9,43100000,4788889
AN NGUY√äN,LONG BI√äN,2026-01-16,4,14500000,3625000
AN NGUY√äN,LONG BI√äN,2026-01-17,6,40400000,6733333
AN NGUY√äN,LONG BI√äN,2026-01-18,6,35400000,5900000
AN NGUY√äN,LONG BI√äN,2026-01-19,7,32100000,4585714
AN NGUY√äN,LONG BI√äN,2026-01-20,6,35200000,5866667
AN NGUY√äN,LONG BI√äN,2026-01-21,7,32500000,4642857
AN NGUY√äN,LONG BI√äN,2026-01-22,6,16000000,2666667
AN NGUY√äN,LONG BI√äN,2026-01-23,2,4499000,2249500
AN NGUY√äN,LONG BI√äN,2026-01-24,4,11300000,2825000
AN NGUY√äN,LONG BI√äN,2026-01-25,2,600000,300000
AN NGUY√äN,LONG BI√äN,2026-01-26,3,7700000,2566667
AN NGUY√äN,LONG BI√äN,2026-01-27,7,40300000,5757143
AN NGUY√äN,LONG BI√äN,2026-01-28,5,19400000,3880000
AN NGUY√äN,LONG BI√äN,2026-01-29,1,4500000,4500000
AN NGUY√äN,LONG BI√äN,2026-01-30,0,0,0
AN NGUY√äN,LONG BI√äN,2026-01-31,0,0,0
AN NHI√äN ,ADV,2026-01-02,3,13900000,4633333
AN NHI√äN ,ADV,2026-01-03,2,6500000,3250000
AN NHI√äN ,ADV,2026-01-04,4,13000000,3250000
AN NHI√äN ,ADV,2026-01-05,4,4800000,1200000
AN NHI√äN ,ADV,2026-01-06,3,6600000,2200000
AN NHI√äN ,ADV,2026-01-07,1,5200000,5200000
AN NHI√äN ,ADV,2026-01-08,3,2800000,933333
AN NHI√äN ,ADV,2026-01-09,2,15100000,7550000
AN NHI√äN ,ADV,2026-01-10,1,2500000,2500000
AN NHI√äN ,ADV,2026-01-11,5,10800000,2160000
AN NHI√äN ,ADV,2026-01-12,4,14000000,3500000
AN NHI√äN ,ADV,2026-01-13,2,1000000,500000
AN NHI√äN ,ADV,2026-01-14,9,14500000,1611111
AN NHI√äN ,ADV,2026-01-15,2,3500000,1750000
AN NHI√äN ,ADV,2026-01-16,3,10500000,3500000
AN NHI√äN ,ADV,2026-01-17,4,15800000,3950000
AN NHI√äN ,ADV,2026-01-18,5,8200000,1640000
AN NHI√äN ,ADV,2026-01-19,4,10800000,2700000
AN NHI√äN ,ADV,2026-01-20,1,4000000,4000000
AN NHI√äN ,ADV,2026-01-21,3,13600000,4533333
AN NHI√äN ,ADV,2026-01-22,7,9100000,1300000
AN NHI√äN ,ADV,2026-01-23,6,1900000,316667
AN NHI√äN ,ADV,2026-01-24,3,6300000,2100000
AN NHI√äN ,ADV,2026-01-25,3,3000000,1000000
AN NHI√äN ,ADV,2026-01-26,1,6000000,6000000
AN NHI√äN ,ADV,2026-01-27,4,14000000,3500000
AN NHI√äN ,ADV,2026-01-29,3,12500000,4166667
AN NHI√äN ,ADV,2026-01-30,3,1600000,533333
AN NHI√äN ,ADV,2026-01-31,3,6500000,2166667
AN NHI√äN ,CMT8,2026-01-02,3,7000000,2333333
AN NHI√äN ,CMT8,2026-01-03,3,11900000,3966667
AN NHI√äN ,CMT8,2026-01-04,5,9500000,1900000
AN NHI√äN ,CMT8,2026-01-05,4,16900000,4225000
AN NHI√äN ,CMT8,2026-01-06,3,1500000,500000
AN NHI√äN ,CMT8,2026-01-07,1,6100000,6100000
AN NHI√äN ,CMT8,2026-01-08,5,28000000,5600000
AN NHI√äN ,CMT8,2026-01-09,3,10000000,3333333
AN NHI√äN ,CMT8,2026-01-10,3,3000000,1000000
AN NHI√äN ,CMT8,2026-01-11,0,0,0
AN NHI√äN ,CMT8,2026-01-12,4,3000000,750000
AN NHI√äN ,CMT8,2026-01-13,3,3500000,1166667
AN NHI√äN ,CMT8,2026-01-14,2,8000000,4000000
AN NHI√äN ,CMT8,2026-01-15,2,1000000,500000
AN NHI√äN ,CMT8,2026-01-16,2,1000000,500000
AN NHI√äN ,CMT8,2026-01-17,6,5800000,966667
AN NHI√äN ,CMT8,2026-01-18,0,800000,0
AN NHI√äN ,CMT8,2026-01-19,4,7800000,1950000
AN NHI√äN ,CMT8,2026-01-20,4,12500000,3125000
AN NHI√äN ,CMT8,2026-01-21,1,0,0
AN NHI√äN ,CMT8,2026-01-22,4,5000000,1250000
AN NHI√äN ,CMT8,2026-01-23,1,1000000,1000000
AN NHI√äN ,CMT8,2026-01-24,3,3600000,1200000
AN NHI√äN ,CMT8,2026-01-25,1,5500000,5500000
AN NHI√äN ,CMT8,2026-01-26,5,10000000,2000000
AN NHI√äN ,CMT8,2026-01-27,1,10500000,10500000
AN NHI√äN ,CMT8,2026-01-28,2,500000,250000
AN NHI√äN ,CMT8,2026-01-29,2,8400000,4200000
AN NHI√äN ,CMT8,2026-01-30,3,9000000,3000000
AN NHI√äN ,CMT8,2026-01-31,4,12000000,3000000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-02,3,35500000,11833333
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-03,9,39699000,4411000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-04,14,80800000,5771428
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-05,10,40150000,4015000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-06,3,10000000,3333333
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-07,6,15800000,2633333
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-08,8,40260000,5032500
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-09,11,71300000,6481818
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-10,7,88440000,12634285
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-11,8,14299000,1787375
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-12,2,21460000,10730000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-13,9,40700000,4522222
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-14,7,101000000,14428571
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-15,7,9700000,1385714
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-16,8,22300000,2787500
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-17,7,45100000,6442857
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-18,7,34700000,4957142
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-19,9,42579000,4731000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-20,6,55300000,9216666
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-21,2,32100000,16050000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-22,1,26300000,26300000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-23,7,15500000,2214285
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-24,6,22160000,3693333
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-25,5,17100000,3420000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-26,6,23800000,3966666
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-27,8,35380000,4422500
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-28,9,21300000,2366666
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-29,7,49500000,7071429
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-30,9,55000000,6111111
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-31,12,60000000,5000000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-02,3,12000000,4000000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-03,8,33000000,4125000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-04,9,42700000,4744444
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-05,6,15600000,2600000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-06,8,35200000,4400000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-07,4,22500000,5625000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-08,7,13020000,1860000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-09,4,34700000,8675000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-10,5,60100000,12020000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-11,6,60200000,10033333
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-12,8,24880000,3110000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-13,6,35049000,5841500
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-14,6,50000000,8333333
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-15,10,21100000,2110000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-16,5,31200000,6240000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-17,8,58600000,7325000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-18,12,60799000,5066583
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-19,6,36100000,6016666
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-20,7,53500000,7642857
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-21,7,104299999,14899999
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-22,5,4700000,940000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-23,5,4498000,899600
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-24,8,25600000,3200000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-25,10,49190000,4919000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-26,5,20210000,4042000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-27,9,26598000,2955333
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-28,3,4100000,1366666
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-29,4,52600000,13150000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-30,6,65000000,10833333
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-31,8,70000000,8750000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-02,7,21300000,3042857
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-03,4,19200000,4800000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-04,8,9200000,1150000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-05,8,13799000,1724875
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-06,2,30600000,15300000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-07,8,33200000,4150000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-08,13,41600000,3200000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-09,8,7300000,912500
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-10,8,14699000,1837375
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-11,6,45100000,7516666
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-12,7,23800000,3400000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-13,1,6660000,6660000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-14,9,30300000,3366666
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-15,8,26600000,3325000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-16,6,19900000,3316666
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-17,11,53200000,4836363
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-18,10,46460000,4646000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-19,3,38400000,12800000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-20,2,24100000,12050000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-21,8,22000000,2750000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-22,3,42700000,14233333
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-23,4,3700000,925000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-24,7,31600000,4514285
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-25,6,47400000,7900000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-26,7,18500000,2642857
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-27,5,7300000,1460000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-28,7,30000000,4285714
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-29,5,23000000,4600000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-30,7,27320000,3902857
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-31,7,22799000,3257000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-02,2,3600000,1800000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-03,7,13500000,1928571
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-04,12,28600000,2383333
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-05,5,14200000,2840000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-06,5,18600000,3720000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-07,5,18100000,3620000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-08,2,5600000,2800000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-09,5,9700000,1940000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-10,15,22800000,1520000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-11,6,17100000,2850000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-12,2,6550000,3275000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-13,6,18800000,3133333
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-14,8,17700000,2212500
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-15,5,7800000,1560000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-16,3,2100000,700000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-17,5,11300000,2260000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-18,4,29150000,7287500
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-19,4,3000000,750000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-20,3,6000000,2000000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-21,4,12700000,3175000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-22,0,5000000,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-23,4,11250000,2812500
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-24,4,13400000,3350000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-25,4,18440000,4610000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-26,6,15800000,2633333
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-27,1,12100000,12100000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-28,4,10700000,2675000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-29,2,1500000,750000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-30,2,3300000,1650000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-31,2,1000000,500000
`;

        const csvRaw_M2 = `
AN NGUY√äN,LONG BI√äN,2026-02-01,2,1500000,750000
AN NGUY√äN,LONG BI√äN,2026-02-02,8,6000000,750000
AN NGUY√äN,LONG BI√äN,2026-02-03,2,20000000,10000000
AN NGUY√äN,LONG BI√äN,2026-02-04,3,10800000,3600000
AN NGUY√äN,LONG BI√äN,2026-02-05,2,13080000,6540000
AN NGUY√äN,LONG BI√äN,2026-02-06,4,17700000,4425000
AN NGUY√äN,LONG BI√äN,2026-02-07,1,0,0
AN NGUY√äN,LONG BI√äN,2026-02-08,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-09,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-10,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-11,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-12,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-13,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-14,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-15,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-16,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-17,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-18,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-19,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-20,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-21,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-22,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-23,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-24,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-25,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-26,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-27,0,0,0
AN NGUY√äN,LONG BI√äN,2026-02-28,0,0,0
AN NHI√äN,CMT8,2026-02-01,2,5000000,2500000
AN NHI√äN,CMT8,2026-02-02,3,4300000,1433333
AN NHI√äN,CMT8,2026-02-03,3,9700000,3233333
AN NHI√äN,CMT8,2026-02-04,7,6000000,857142
AN NHI√äN,CMT8,2026-02-05,3,3600000,1200000
AN NHI√äN,CMT8,2026-02-06,0,0,0
AN NHI√äN,CMT8,2026-02-07,0,0,0
AN NHI√äN,CMT8,2026-02-08,0,0,0
AN NHI√äN,CMT8,2026-02-09,0,0,0
AN NHI√äN,CMT8,2026-02-10,0,0,0
AN NHI√äN,CMT8,2026-02-11,0,0,0
AN NHI√äN,CMT8,2026-02-12,0,0,0
AN NHI√äN,CMT8,2026-02-13,0,0,0
AN NHI√äN,CMT8,2026-02-14,0,0,0
AN NHI√äN,CMT8,2026-02-15,0,0,0
AN NHI√äN,CMT8,2026-02-16,0,0,0
AN NHI√äN,CMT8,2026-02-17,0,0,0
AN NHI√äN,CMT8,2026-02-18,0,0,0
AN NHI√äN,CMT8,2026-02-19,0,0,0
AN NHI√äN,CMT8,2026-02-20,0,0,0
AN NHI√äN,CMT8,2026-02-21,0,0,0
AN NHI√äN,CMT8,2026-02-22,0,0,0
AN NHI√äN,CMT8,2026-02-23,0,0,0
AN NHI√äN,CMT8,2026-02-24,0,0,0
AN NHI√äN,CMT8,2026-02-25,0,0,0
AN NHI√äN,CMT8,2026-02-26,0,0,0
AN NHI√äN,CMT8,2026-02-27,0,0,0
AN NHI√äN,CMT8,2026-02-28,0,0,0
AN NHI√äN,ADV,2026-02-01,3,3500000,1166666
AN NHI√äN,ADV,2026-02-02,1,7700000,7700000
AN NHI√äN,ADV,2026-02-03,5,14800000,2960000
AN NHI√äN,ADV,2026-02-04,2,9500000,4750000
AN NHI√äN,ADV,2026-02-05,3,1000000,333333
AN NHI√äN,ADV,2026-02-06,0,0,0
AN NHI√äN,ADV,2026-02-07,0,0,0
AN NHI√äN,ADV,2026-02-08,0,0,0
AN NHI√äN,ADV,2026-02-09,0,0,0
AN NHI√äN,ADV,2026-02-10,0,0,0
AN NHI√äN,ADV,2026-02-11,0,0,0
AN NHI√äN,ADV,2026-02-12,0,0,0
AN NHI√äN,ADV,2026-02-13,0,0,0
AN NHI√äN,ADV,2026-02-14,0,0,0
AN NHI√äN,ADV,2026-02-15,0,0,0
AN NHI√äN,ADV,2026-02-16,0,0,0
AN NHI√äN,ADV,2026-02-17,0,0,0
AN NHI√äN,ADV,2026-02-18,0,0,0
AN NHI√äN,ADV,2026-02-19,0,0,0
AN NHI√äN,ADV,2026-02-20,0,0,0
AN NHI√äN,ADV,2026-02-21,0,0,0
AN NHI√äN,ADV,2026-02-22,0,0,0
AN NHI√äN,ADV,2026-02-23,0,0,0
AN NHI√äN,ADV,2026-02-24,0,0,0
AN NHI√äN,ADV,2026-02-25,0,0,0
AN NHI√äN,ADV,2026-02-26,0,0,0
AN NHI√äN,ADV,2026-02-27,0,0,0
AN NHI√äN,ADV,2026-02-28,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-01,1,21080000,21080000
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-02,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-03,10,40400000,4040000
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-04,11,48600000,4418181
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-05,14,58000000,4142857
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-06,6,26940000,4490000
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-07,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-08,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-09,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-10,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-11,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-12,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-13,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-14,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-15,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-16,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-17,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-18,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-19,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-20,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-21,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-22,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-23,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-24,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-25,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-26,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-27,0,0,0
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-28,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-01,2,11500000,5750000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-02,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-03,5,25499000,5099800
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-04,1,13200000,13200000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-05,8,23100000,2887500
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-06,2,7300000,3650000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-07,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-08,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-09,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-10,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-11,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-12,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-13,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-14,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-15,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-16,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-17,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-18,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-19,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-20,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-21,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-22,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-23,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-24,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-25,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-26,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-27,0,0,0
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-28,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-01,7,13100000,1871428
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-02,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-03,8,26400000,3300000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-04,6,9300000,1550000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-05,10,30900000,3090000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-06,12,500000,41666
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-07,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-08,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-09,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-10,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-11,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-12,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-13,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-14,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-15,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-16,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-17,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-18,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-19,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-20,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-21,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-22,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-23,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-24,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-25,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-26,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-27,0,0,0
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-28,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-01,3,1500000,500000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-02,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-03,8,11900000,1487500
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-04,4,12500000,3125000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-05,7,23600000,3371428
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-06,3,2200000,733333
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-07,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-08,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-09,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-10,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-11,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-12,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-13,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-14,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-15,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-16,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-17,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-18,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-19,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-20,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-21,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-22,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-23,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-24,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-25,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-26,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-27,0,0,0
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-28,0,0,0
`;

        // --- 2. CSV RAW DATA (Ads Cost) - UPDATED FROM 'ToÃÇÃâng hoÃõÃ£p.xlsx' ---
        const csvAdsRaw_M1 = `
AN NGUY√äN,LONG BI√äN,2026-01-31,200281629
AN NHI√äN,ADV,2026-01-31,141863670
AN NHI√äN,CMT8,2026-01-31,70221332
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-31,155995939
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-31,187948814
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-31,113236478
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-31,314208557
`;
        
        const csvAdsRaw_M2 = `
AN NGUY√äN,LONG BI√äN,2026-02-28,12760141
AN NHI√äN,ADV,2026-02-28,18046268
AN NHI√äN,CMT8,2026-02-28,9894774
PH·ª§C LINH,X√É ƒê√ÄN,2026-02-28,42348241
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-02-28,36262191
PH·ª§C LINH,H√Ä ƒê√îNG,2026-02-28,33050186
PH·ª§C LINH,H·∫¢I PH√íNG,2026-02-28,18411240
`;

        // --- 3. SUMMARY TARGETS & REAL REVENUE - FROM 'ToÃÇÃâng hoÃõÃ£p.xlsx' ---
        // Added real_revenue, real_customers, and breakeven to ensure Cards display correct totals from Summary file
        const summaryData_M1 = [
            { brand: 'AN NGUY√äN', branch: 'LONG BI√äN', target: 700000000, real_revenue: 631098000, real_customers: 156, breakeven: 600000000 },
            { brand: 'AN NHI√äN', branch: 'ADV', target: 500000000, real_revenue: 248000000, real_customers: 102, breakeven: 350000000 },
            { brand: 'AN NHI√äN', branch: 'CMT8', target: 500000000, real_revenue: 191100000, real_customers: 85, breakeven: 350000000 },
            { brand: 'PH·ª§C LINH', branch: 'C·∫¶U GI·∫§Y', target: 880000000, real_revenue: 1054692999, real_customers: 192, breakeven: 600000000 },
            { brand: 'PH·ª§C LINH', branch: 'H√Ä ƒê√îNG', target: 820000000, real_revenue: 782337000, real_customers: 195, breakeven: 600000000 }, 
            { brand: 'PH·ª§C LINH', branch: 'H·∫¢I PH√íNG', target: 500000000, real_revenue: 359390000, real_customers: 137, breakeven: 450000000 }, 
            { brand: 'PH·ª§C LINH', branch: 'X√É ƒê√ÄN', target: 1080000000, real_revenue: 1100867000, real_customers: 198, breakeven: 800000000 } 
        ];

        const summaryData_M2 = [{"brand": "AN NGUY√äN", "branch": "LONG BI√äN", "real_revenue": 69080000, "target": 700000000, "real_customers": 20, "breakeven": 600000000}, {"brand": "AN NHI√äN", "branch": "ADV", "real_revenue": 36500000, "target": 500000000, "real_customers": 14, "breakeven": 350000000}, {"brand": "AN NHI√äN", "branch": "CMT8", "real_revenue": 28600000, "target": 500000000, "real_customers": 18, "breakeven": 350000000}, {"brand": "PH·ª§C LINH", "branch": "X√É ƒê√ÄN", "real_revenue": 194020000, "target": 1080000000, "real_customers": 41, "breakeven": 800000000}, {"brand": "PH·ª§C LINH", "branch": "C·∫¶U GI·∫§Y", "real_revenue": 80599000, "target": 880000000, "real_customers": 18, "breakeven": 600000000}, {"brand": "PH·ª§C LINH", "branch": "H√Ä ƒê√îNG", "real_revenue": 81400000, "target": 820000000, "real_customers": 33, "breakeven": 600000000}, {"brand": "PH·ª§C LINH", "branch": "H·∫¢I PH√íNG", "real_revenue": 50600000, "target": 550000000, "real_customers": 25, "breakeven": 450000000}];

        // --- CONSULTANT COMMENTS ---
        const comments_M1 = `
            <p><strong>1. Hi·ªán tr·∫°ng Kinh doanh</strong><br>
            <span class="font-bold">‚Ä¢ Ph√¢n h√≥a doanh thu:</span> C√≥ s·ª± ch√™nh l·ªách l·ªõn. <span class="text-green-600 font-bold">C·∫ßu Gi·∫•y (118%)</span> v√† <span class="text-green-600 font-bold">X√£ ƒê√†n (101.77%)</span> xu·∫•t s·∫Øc v∆∞·ª£t KPI. Ng∆∞·ª£c l·∫°i, <span class="text-red-600 font-bold">ADV v√† CMT8</span> r∆°i v√†o m·ª©c b√°o ƒë·ªông ƒë·ªè (d∆∞·ªõi 50%). <span class="text-yellow-600 font-bold">H√† ƒê√¥ng v√† Long Bi√™n</span> ho√†n th√†nh ·ªü m·ª©c kh√° (tr√™n 90%).<br>
            <span class="font-bold">‚Ä¢ Gi√° tr·ªã ƒë∆°n h√†ng:</span> T∆∞∆°ng ƒë·ªìng v·ªõi doanh thu. Nh√≥m d·∫´n ƒë·∫ßu ƒë·∫°t trung b√¨nh tr√™n 5 tri·ªáu/ƒë∆°n, trong khi nh√≥m cu·ªëi b·∫£ng (ADV, CMT8, H·∫£i Ph√≤ng) ch·ªâ ƒë·∫°t m·ª©c th·∫•p ~2.5 tri·ªáu.</p>
            <p><strong>2. Hi·ªáu qu·∫£ Marketing</strong><br>
            <span class="font-bold text-green-600">‚Ä¢ T·ªëi ∆∞u nh·∫•t:</span> <strong>C·∫ßu Gi·∫•y</strong> (Chi ph√≠ Ads trung b√¨nh nh∆∞ng doanh thu thu·ªôc top ƒë·∫ßu).<br>
            <span class="font-bold text-red-600">‚Ä¢ L√£ng ph√≠:</span> <strong>X√£ ƒê√†n</strong> (Doanh thu cao nh∆∞ng chi ph√≠ Ads g·∫•p ƒë√¥i C·∫ßu Gi·∫•y). <strong>H√† ƒê√¥ng v√† Long Bi√™n</strong> c≈©ng chi ti√™u cao nh∆∞ng doanh thu ch∆∞a t∆∞∆°ng x·ª©ng.</p>
            <p><strong>3. ƒê·ªÅ xu·∫•t tr·ªçng t√¢m</strong><br>
            <span class="font-bold text-zen-tea">‚ñ∂Ô∏è Chi·∫øn l∆∞·ª£c:</span> L·∫•y <strong>C·∫ßu Gi·∫•y</strong> l√†m m√¥ h√¨nh chu·∫©n ƒë·ªÉ nh√¢n r·ªông quy tr√¨nh ch·ªët ƒë∆°n v√† qu·∫£n l√Ω chi ph√≠.<br>
            <span class="font-bold text-zen-tea">‚ñ∂Ô∏è T·ªëi ∆∞u:</span> C·∫Øt gi·∫£m, tinh ch·ªânh Ads t·∫°i <strong>X√£ ƒê√†n</strong> ƒë·ªÉ b·∫£o to√†n l·ª£i nhu·∫≠n.<br>
            <span class="font-bold text-zen-tea">‚ñ∂Ô∏è C·∫£i t·ªï:</span> T√°i c·∫•u tr√∫c to√†n di·ªán <strong>ADV & CMT8</strong> (v·ªÅ v·ªã tr√≠/kh√°ch h√†ng); t·∫≠p trung ƒë√†o t·∫°o Upsell ƒë·ªÉ tƒÉng gi√° tr·ªã bill t·∫°i <strong>H·∫£i Ph√≤ng</strong>.</p>
        `;

        const comments_M2 = `
            <p><strong>1. Kh·ªüi ƒë·ªông Th√°ng 2</strong><br>
            D·ªØ li·ªáu ƒë·∫ßu th√°ng 2 cho th·∫•y s·ª± kh·ªüi ƒë·∫ßu ch·∫≠m r√£i sau k·ª≥ ngh·ªâ T·∫øt. C√°c ch·ªâ s·ªë doanh thu v√† l∆∞·ª£ng kh√°ch ƒëang ·ªü m·ª©c th·∫•p so v·ªõi trung b√¨nh th√°ng 1. C·∫ßn theo d√µi s√°t sao ƒë·ªÉ c√≥ bi·ªán ph√°p k√≠ch c·∫ßu k·ªãp th·ªùi.</p>
            <p><strong>2. ƒêi·ªÉm c·∫ßn l∆∞u √Ω</strong><br>
            <span class="text-yellow-600 font-bold">‚Ä¢</span> Doanh thu c√°c ng√†y ƒë·∫ßu th√°ng c√≤n th·∫•p, ch∆∞a ph·∫£n √°nh ƒë√∫ng ti·ªÅm nƒÉng th·ª±c t·∫ø.<br>
            <span class="text-yellow-600 font-bold">‚Ä¢</span> Chi ph√≠ Ads th√°ng 2 ƒë√£ b·∫Øt ƒë·∫ßu ƒë∆∞·ª£c ph√¢n b·ªï, c·∫ßn theo d√µi hi·ªáu qu·∫£ chuy·ªÉn ƒë·ªïi (CIR) ngay t·ª´ nh·ªØng ng√†y ƒë·∫ßu.</p>
            <p><strong>3. ƒê·ªÅ xu·∫•t h√†nh ƒë·ªông</strong><br>
            <span class="font-bold text-zen-tea">‚ñ∂Ô∏è</span> ƒê·∫©y m·∫°nh c√°c ch∆∞∆°ng tr√¨nh khai xu√¢n, l√¨ x√¨ ƒë·∫ßu nƒÉm ƒë·ªÉ thu h√∫t kh√°ch h√†ng quay tr·ªü l·∫°i.<br>
            <span class="font-bold text-zen-tea">‚ñ∂Ô∏è</span> T·ªëi ∆∞u h√≥a l·∫°i c√°c chi·∫øn d·ªãch qu·∫£ng c√°o, t·∫≠p trung v√†o c√°c d·ªãch v·ª• ph√π h·ª£p v·ªõi nhu c·∫ßu sau T·∫øt.</p>
        `;

        // --- 6. MARKETING DATA ---
        const csvMarketing = `
Ph·ª•c Linh,1319,359,89
An Nguy√™n,65,19,17
An Nhi√™n ADV,124,34,14
An Nhi√™n CMT8,172,48,20
`;

        // --- GLOBAL STATE ---
        let currentMonth = 2; // Default to Month 2
        let currentBrand = 'all';
        let parsedDailyData = [];
        let parsedAdsData = [];
        let currentSummaryData = [];
        let parsedMarketingData = [];
        let chartInstances = {};
        
        // --- OBSERVER ---
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    const progressBars = entry.target.querySelectorAll('.progress-bar-fill');
                    progressBars.forEach(bar => {
                        const targetWidth = bar.getAttribute('data-width');
                        setTimeout(() => { bar.style.width = targetWidth + '%'; }, 200);
                    });
                    revealObserver.unobserve(entry.target);
                }
            });
        }, { root: document.getElementById('scroll-body'), threshold: 0.1 });

        // Header Scroll
        document.getElementById('scroll-body').addEventListener('scroll', function() {
            const header = document.getElementById('main-header');
            if (this.scrollTop > 20) {
                header.classList.add('bg-white/90', 'backdrop-blur-md', 'shadow-sm');
                header.classList.remove('bg-white/70', 'backdrop-blur-sm');
            } else {
                header.classList.add('bg-white/70', 'backdrop-blur-sm');
                header.classList.remove('bg-white/90', 'backdrop-blur-md', 'shadow-sm');
            }
        });

        // --- INIT ---
        function initMonthSelector() {
            const container = document.getElementById('month-selector');
            container.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                const btn = document.createElement('button');
                btn.id = `btn-m${i}`;
                btn.className = `month-btn px-3 py-1 text-xs font-bold rounded-lg transition-all whitespace-nowrap ${i === 2 ? 'bg-zen-tea text-white shadow-sm' : 'text-gray-500 hover:bg-white hover:text-zen-tea'}`;
                btn.innerText = `T${i}`;
                btn.onclick = () => setMonth(i);
                container.appendChild(btn);
            }
        }

        // --- PARSERS ---
        function parseCSV(raw, type) {
            const lines = raw.trim().split('\n');
            const data = [];
            lines.forEach(line => {
                const cols = line.split(',');
                if(cols.length < 3) return;
                
                if (type === 'marketing') {
                     const name = cols[0].trim();
                    if(name && name !== 'C∆° s·ªü') {
                         data.push({
                            name: name,
                            leads: parseInt(cols[1]) || 0,
                            phones: parseInt(cols[2]) || 0,
                            arrived: parseInt(cols[3]) || 0
                        });
                    }
                } else {
                    const brand = cols[0].trim();
                    const branch = cols[1].trim();
                    const dateStr = cols[2].trim();
                    if(dateStr.startsWith('2026')) {
                        const val = parseFloat(cols[3]) || 0;
                        data.push({
                            brand, branch, date: dateStr,
                            month: parseInt(dateStr.split('-')[1]),
                            day: parseInt(dateStr.split('-')[2]),
                            value1: val, // Cust or Ads
                            value2: parseFloat(cols[4]) || 0, // Rev
                            value3: parseFloat(cols[5]) || 0 // Average Bill
                        });
                    }
                }
            });
            return data;
        }

        function setMonth(m) {
            currentMonth = m;
            document.querySelectorAll('.month-btn').forEach((btn, idx) => {
                const monthId = idx + 1;
                if(monthId === m) {
                    btn.classList.remove('bg-white', 'text-gray-500', 'hover:bg-white', 'hover:text-zen-tea');
                    btn.classList.add('bg-zen-tea', 'text-white');
                } else {
                    btn.classList.add('bg-white', 'text-gray-500', 'hover:bg-white', 'hover:text-zen-tea');
                    btn.classList.remove('bg-zen-tea', 'text-white');
                }
            });
            
            const monthDisplay = document.getElementById('displayMonth');
            if(monthDisplay) monthDisplay.innerText = m;

            // Load Data for Selected Month
            if (m === 1) {
                parsedDailyData = parseCSV(csvRaw_M1, 'rev');
                parsedAdsData = parseCSV(csvAdsRaw_M1, 'ads');
                currentSummaryData = summaryData_M1;
                document.getElementById('consultant-content').innerHTML = comments_M1;
            } else if (m === 2) {
                parsedDailyData = parseCSV(csvRaw_M2, 'rev');
                parsedAdsData = parseCSV(csvAdsRaw_M2, 'ads');
                currentSummaryData = summaryData_M2;
                document.getElementById('consultant-content').innerHTML = comments_M2;
            } else {
                parsedDailyData = [];
                parsedAdsData = [];
                currentSummaryData = [];
                document.getElementById('consultant-content').innerHTML = "<p>Ch∆∞a c√≥ d·ªØ li·ªáu.</p>";
            }
            
            updateDashboard();
        }

        function filterBrand(brand) {
            currentBrand = brand;
            document.querySelectorAll('.sidebar-item').forEach(el => {
                const onclickVal = el.getAttribute('onclick');
                if(onclickVal && onclickVal.includes(`'${brand}'`)) el.classList.add('active');
                else el.classList.remove('active');
            });
            updateDashboard();
        }

        // --- MAIN LOGIC ---
        function updateDashboard() {
            let dailyRev = parsedDailyData; 
            let dailyAds = parsedAdsData;

            if (currentBrand !== 'all') {
                dailyRev = dailyRev.filter(d => d.brand === currentBrand);
                dailyAds = dailyAds.filter(d => d.brand === currentBrand);
            }

            const branchMap = {};
            let filteredSummary = currentSummaryData;
            if (currentBrand !== 'all') filteredSummary = currentSummaryData.filter(d => d.brand === currentBrand);
            
            filteredSummary.forEach(s => {
                branchMap[s.branch] = { 
                    brand: s.brand, 
                    branch: s.branch, 
                    target: s.target, 
                    breakeven: s.breakeven,
                    revenue: s.real_revenue || 0, 
                    customers: s.real_customers || 0, 
                    ads: 0 
                };
            });

            dailyAds.forEach(d => {
                if(branchMap[d.branch]) {
                    branchMap[d.branch].ads += d.value1; 
                }
            });

            const aggregatedData = Object.values(branchMap);
            const totalRevenue = aggregatedData.reduce((sum, d) => sum + d.revenue, 0);
            const totalCustomers = aggregatedData.reduce((sum, d) => sum + d.customers, 0);
            const totalAds = aggregatedData.reduce((sum, d) => sum + d.ads, 0);
            const avgBill = totalCustomers > 0 ? Math.round(totalRevenue / totalCustomers) : 0;

            animateValue("kpi-revenue", parseInt(document.getElementById('kpi-revenue').innerText.replace(/\D/g,'')) || 0, totalRevenue, 1000);
            animateValue("kpi-customers", parseInt(document.getElementById('kpi-customers').innerText.replace(/\D/g,'')) || 0, totalCustomers, 1000);
            animateValue("kpi-ads", parseInt(document.getElementById('kpi-ads').innerText.replace(/\D/g,'')) || 0, totalAds, 1000);
            animateValue("kpi-bill", parseInt(document.getElementById('kpi-bill').innerText.replace(/\D/g,'')) || 0, avgBill, 1000);

            renderMainChart(dailyRev); 
            renderMarketingFunnels();
            renderBranchCards(aggregatedData); 
            renderAdsTable(aggregatedData);
            
            setTimeout(() => {
                document.querySelectorAll('.reveal-on-scroll').forEach(el => revealObserver.observe(el));
                lucide.createIcons();
            }, 100);
        }

        function animateValue(id, start, end, duration) {
            if (start === end) return;
            const obj = document.getElementById(id);
            const range = end - start;
            let current = start;
            const stepTime = Math.abs(Math.floor(duration / (range / (range > 100 ? 100 : 1))));
            const steps = 20; const stepVal = range / steps;
            let stepCount = 0;
            const timer = setInterval(function() {
                stepCount++; current += stepVal;
                obj.innerText = new Intl.NumberFormat('vi-VN').format(Math.round(current));
                if (stepCount >= steps) { obj.innerText = new Intl.NumberFormat('vi-VN').format(end); clearInterval(timer); }
            }, duration / steps);
        }

        // --- RENDERERS ---

        function renderMarketingFunnels() {
            const container = document.getElementById('marketingContainer');
            container.innerHTML = '';
            
            let funnelData = parsedMarketingData; 
            
            if (currentBrand !== 'all') {
                if (currentBrand === 'PH·ª§C LINH') funnelData = funnelData.filter(d => d.name === 'Ph·ª•c Linh');
                else if (currentBrand === 'AN NGUY√äN') funnelData = funnelData.filter(d => d.name === 'An Nguy√™n');
                else if (currentBrand === 'AN NHI√äN') funnelData = funnelData.filter(d => d.name.includes('An Nhi√™n'));
            }

            funnelData.forEach((item, index) => {
                const rateLeadToPhone = item.leads > 0 ? (item.phones / item.leads * 100).toFixed(1) : 0;
                const ratePhoneToArrive = item.phones > 0 ? (item.arrived / item.phones * 100).toFixed(1) : 0;
                
                const div = document.createElement('div');
                div.className = "bg-zen-card p-5 rounded-xl border border-zen-gray shadow-sm reveal-on-scroll";
                div.style.transitionDelay = `${index * 100}ms`;
                div.innerHTML = `
                    <h4 class="font-bold text-zen-dark mb-4 text-center">${item.name}</h4>
                    <div class="h-48 relative">
                         <canvas id="funnel-${index}"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-2 text-center text-[10px]">
                        <div>
                            <div class="font-bold text-gray-500">Lead->SƒêT</div>
                            <div class="text-zen-tea font-bold text-xs">${rateLeadToPhone}%</div>
                        </div>
                         <div>
                            <div class="font-bold text-gray-500">SƒêT->Kh√°ch ƒë·∫øn</div>
                            <div class="text-blue-500 font-bold text-xs">${ratePhoneToArrive}%</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);

                const ctx = div.querySelector('canvas').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['T·ªïng Lead', 'SƒêT', 'Kh√°ch ƒê·∫øn'],
                        datasets: [{
                            label: 'S·ªë l∆∞·ª£ng',
                            data: [item.leads, item.phones, item.arrived],
                            backgroundColor: [
                                'rgba(203, 191, 163, 0.6)', 
                                'rgba(107, 143, 113, 0.6)', 
                                'rgba(59, 130, 246, 0.6)'   
                            ],
                            borderColor: [
                                '#CBBFA3',
                                '#6B8F71',
                                '#3b82f6'
                            ],
                            borderWidth: 1,
                            barPercentage: 0.6
                        }]
                    },
                    options: {
                        indexAxis: 'y', 
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            datalabels: { 
                                color: '#3F3F3F',
                                anchor: 'end',
                                align: 'right',
                                font: {
                                    weight: 'bold',
                                    size: 11
                                },
                                formatter: (value) => new Intl.NumberFormat('vi-VN').format(value)
                            },
                             tooltip: {
                                enabled: false 
                            }
                        },
                        scales: {
                            x: { 
                                grid: { display: false }, 
                                beginAtZero: true,
                                display: false 
                            },
                            y: { grid: { display: false } }
                        }
                    },
                    plugins: [ChartDataLabels] 
                });
            });
        }

        function renderBranchCards(data) {
            const container = document.getElementById('branchContainer');
            container.innerHTML = '';
            const sorted = [...data].sort((a,b) => b.revenue - a.revenue);
            if (sorted.length === 0) { container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-4">Ch∆∞a c√≥ d·ªØ li·ªáu.</p>'; return; }
            sorted.forEach((item, idx) => {
                const percent = item.target > 0 ? (item.revenue / item.target) * 100 : 0;
                
                // Breakeven logic
                const bePercent = item.target > 0 ? (item.breakeven / item.target) * 100 : 0;
                const isProfitable = item.revenue >= item.breakeven;
                
                const isTop1 = idx === 0;
                const card = document.createElement('div');
                const baseClasses = "bg-zen-card p-5 rounded-xl border flex flex-col justify-between reveal-on-scroll";
                const borderClass = isTop1 ? "card-top-1 z-10" : "border-zen-gray card-hover shadow-sm";
                card.className = `${baseClasses} ${borderClass}`; card.style.transitionDelay = `${idx * 150}ms`;
                let brandColor = 'text-zen-tea'; let brandBg = 'bg-zen-sage/20';
                if(item.brand === 'AN NHI√äN') { brandColor = 'text-orange-600'; brandBg = 'bg-orange-100'; }
                if(item.brand === 'PH·ª§C LINH') { brandColor = 'text-blue-600'; brandBg = 'bg-blue-100'; }
                
                card.innerHTML = `
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-zen-dark text-lg ${isTop1 ? 'text-yellow-600' : ''}">${item.branch}</h4>
                            <span class="text-[10px] font-bold ${brandColor} ${brandBg} px-2 py-1 rounded-md uppercase tracking-wide">${item.brand}</span>
                        </div>
                        <div class="flex flex-col gap-1 mb-2">
                             <div class="flex justify-between items-baseline"><span class="text-gray-400 text-xs">Doanh thu</span><span class="text-xl font-bold text-zen-dark">${new Intl.NumberFormat('vi-VN').format(item.revenue)}</span></div>
                             ${item.target > 0 ? `<div class="flex justify-between items-baseline"><span class="text-gray-400 text-xs">Target</span><span class="text-xs font-bold text-gray-500">${new Intl.NumberFormat('vi-VN').format(item.target)}</span></div>` : ''}
                        </div>
                    </div>
                    ${item.target > 0 ? `
                    <div class="mt-2 pt-2 border-t border-gray-100">
                        <div class="progress-bar-bg mb-2 bg-gray-200">
                            <div class="breakeven-marker" style="left: ${Math.min(bePercent, 100)}%;"></div>
                            <div class="breakeven-label" style="left: ${Math.min(bePercent, 100)}%;">DT h√≤a v·ªën</div>
                            <div class="progress-bar-fill h-1.5 rounded-full ${isProfitable ? 'bg-green-500' : 'bg-red-400'}" style="width: 0%" data-width="${Math.min(percent, 100)}"></div>
                        </div>
                        
                        <div class="flex justify-between items-center text-xs">
                            <span class="${percent >= 100 ? 'text-green-600' : 'text-gray-500'} font-bold">ƒê·∫°t ${percent.toFixed(1)}%</span>
                            <div class="flex items-center text-gray-500"><i data-lucide="users" class="w-3 h-3 mr-1"></i> ${item.customers}</div>
                        </div>
                        <div class="text-[10px] text-gray-400 mt-1 flex justify-between">
                             <span>${isProfitable ? '‚úÖ ƒê√£ c√≥ l√£i' : 'üîª Ch∆∞a h√≤a v·ªën'}</span>
                             <span>M·ªëc HV: ${formatShort(item.breakeven)}</span>
                        </div>
                    </div>` : ''}
                `;
                container.appendChild(card);
            });
        }

        function renderAdsTable(data) {
            const tbody = document.getElementById('adsTableBody');
            tbody.innerHTML = '';
            const sorted = [...data].sort((a, b) => b.ads - a.ads);
            
            sorted.forEach(item => {
                if(item.ads === 0 && item.revenue === 0) return;

                const tr = document.createElement('tr');
                const cir = item.revenue > 0 ? (item.ads / item.revenue) * 100 : 0;
                
                let brandIcon = 'sprout';
                let brandColor = 'text-zen-tea';
                if(item.brand === 'AN NHI√äN') { brandIcon = 'sun'; brandColor = 'text-orange-500'; }
                if(item.brand === 'PH·ª§C LINH') { brandIcon = 'heart-pulse'; brandColor = 'text-blue-500'; }

                let cirClass = 'text-zen-dark';
                let cirBadge = '<span class="px-2 py-1 rounded bg-gray-100 text-gray-500 text-xs font-bold">·ªîn ƒë·ªãnh</span>';
                
                if (cir > 50) {
                    cirClass = 'text-red-500 font-bold';
                    cirBadge = '<span class="px-2 py-1 rounded bg-red-100 text-red-600 text-xs font-bold">Trung b√¨nh</span>';
                } else if (cir > 30) {
                    cirClass = 'text-yellow-600 font-bold';
                    cirBadge = '<span class="px-2 py-1 rounded bg-yellow-100 text-yellow-600 text-xs font-bold">Kh√°</span>';
                } else if (cir > 0) {
                    cirClass = 'text-green-600 font-bold';
                    cirBadge = '<span class="px-2 py-1 rounded bg-green-100 text-green-600 text-xs font-bold">T·ªët</span>';
                }

                tr.innerHTML = `
                    <td><i data-lucide="${brandIcon}" class="w-4 h-4 ${brandColor}"></i></td>
                    <td class="font-bold text-zen-dark">${item.branch}</td>
                    <td class="text-right font-mono">${new Intl.NumberFormat('vi-VN').format(item.ads)}</td>
                    <td class="text-right text-gray-500">${new Intl.NumberFormat('vi-VN').format(item.revenue)}</td>
                    <td class="text-right ${cirClass}">${cir.toFixed(2)}%</td>
                    <td class="text-right">${cirBadge}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderMainChart(dailyData) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const daysInMonth = (currentMonth === 2) ? 28 : 31;
            const labels = Array.from({length: daysInMonth}, (_, i) => i + 1);
            const revData = new Array(daysInMonth).fill(0);
            const billData = new Array(daysInMonth).fill(0); 
            const custData = new Array(daysInMonth).fill(0); 
            
            const dailyGroups = {};
            dailyData.forEach(d => {
                if (!dailyGroups[d.day]) {
                    dailyGroups[d.day] = { rev: 0, billSum: 0, count: 0, cust: 0 };
                }
                dailyGroups[d.day].rev += d.value2;
                dailyGroups[d.day].cust += d.value1;
                if (d.value3 > 0) {
                    dailyGroups[d.day].billSum += d.value3;
                    dailyGroups[d.day].count++;
                }
            });

            for (let i = 1; i <= daysInMonth; i++) {
                if (dailyGroups[i]) {
                    revData[i-1] = dailyGroups[i].rev;
                    custData[i-1] = dailyGroups[i].cust;
                    billData[i-1] = dailyGroups[i].count > 0 ? (dailyGroups[i].billSum / dailyGroups[i].count) : 0;
                }
            }

            if(chartInstances.main) chartInstances.main.destroy();
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(107, 143, 113, 0.4)'); gradient.addColorStop(1, 'rgba(107, 143, 113, 0.0)');
            
            chartInstances.main = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { 
                            label: 'Doanh Thu Ng√†y', 
                            data: revData, 
                            type: 'line', 
                            borderColor: '#6B8F71', 
                            backgroundColor: gradient, 
                            borderWidth: 2, 
                            tension: 0.4, 
                            fill: true, 
                            yAxisID: 'y', 
                            order: 2,
                            pointRadius: 0, 
                            pointHoverRadius: 6, 
                            pointBackgroundColor: '#6B8F71',
                            datalabels: { display: false } 
                        },
                        { 
                            label: 'Trung B√¨nh Bill', 
                            data: billData, 
                            type: 'line', 
                            borderColor: '#D4AF37', 
                            backgroundColor: 'transparent',
                            borderWidth: 2, 
                            borderDash: [5, 5], 
                            tension: 0.4, 
                            yAxisID: 'y_bill', 
                            order: 1,
                            pointRadius: 0, 
                            pointHoverRadius: 6, 
                            pointBackgroundColor: '#D4AF37',
                            datalabels: { display: false }
                        },
                        {
                            label: 'L∆∞·ª£ng Kh√°ch',
                            data: custData,
                            type: 'bar',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)', 
                            hoverBackgroundColor: 'rgba(59, 130, 246, 0.4)',
                            borderRadius: 4,
                            yAxisID: 'y_cust',
                            order: 3,
                            datalabels: { display: false }
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, animation: { duration: 2000, easing: 'easeOutQuart' }, interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { display: true, position: 'top', align: 'end', labels: { boxWidth: 10, usePointStyle: true, font: {size: 11, family: 'Nunito'} } },
                        tooltip: { 
                            backgroundColor: 'rgba(255, 255, 255, 0.95)', 
                            titleColor: '#3F3F3F', 
                            bodyColor: '#3F3F3F', 
                            borderColor: '#E5E5E5', 
                            borderWidth: 1, 
                            padding: 10, 
                            displayColors: true, 
                            callbacks: { 
                                label: function(context) { 
                                    let label = context.dataset.label || ''; 
                                    if (label) { label += ': '; } 
                                    if (context.parsed.y !== null) { 
                                        if (context.dataset.yAxisID === 'y_cust') {
                                            label += context.parsed.y + ' kh√°ch';
                                        } else {
                                            label += new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(context.parsed.y); 
                                        }
                                    } 
                                    return label; 
                                } 
                            } 
                        }
                    },
                    scales: { 
                        x: { grid: { display: false }, ticks: { font: {size: 10} } }, 
                        y: { 
                            type: 'linear', 
                            display: true, 
                            position: 'left', 
                            grid: { borderDash: [4, 4], color: '#f0f0f0' }, 
                            ticks: { callback: v => v/1000000 + 'M', font: {size: 10} } 
                        }, 
                        y_bill: { 
                            type: 'linear', 
                            display: true, 
                            position: 'right', 
                            grid: { drawOnChartArea: false }, 
                            max: 10000000, 
                            ticks: { 
                                callback: v => v/1000000 + 'M', 
                                font: {size: 10}, 
                                color: '#D4AF37' 
                            } 
                        },
                        y_cust: {
                            type: 'linear',
                            display: false, 
                            position: 'right', 
                            grid: { display: false },
                            suggestedMax: 50 
                        }
                    }
                }
            });
        }

        // --- UTILS ---
        function formatShort(n) {
            if (n >= 1000000000) return (n/1000000000).toFixed(1) + ' t·ª∑';
            if (n >= 1000000) return (n/1000000).toFixed(0) + 'tr';
            return new Intl.NumberFormat('vi-VN').format(n);
        }

        window.onload = function() {
            lucide.createIcons();
            initMonthSelector();
            parsedDailyData = parseCSV(csvRaw_M1, 'rev').concat(parseCSV(csvRaw_M2, 'rev'));
            parsedAdsData = parseCSV(csvAdsRaw_M1, 'ads').concat(parseCSV(csvAdsRaw_M2, 'ads'));
            parsedMarketingData = parseCSV(csvMarketing, 'marketing');
            setMonth(2); 
        };
    </script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  if (typeof csvMarketing === "undefined") return;

  var container = document.getElementById("marketingContainer");
  if (!container) return;

  var rows = csvMarketing.trim().split("\n").map(function(r){
    var p = r.split(",");
    return {
      branch: p[0],
      lead: Number(p[1]) || 0,
      phone: Number(p[2]) || 0,
      visit: Number(p[3]) || 0
    };
  });

  container.innerHTML = rows.map(function(r){
    var rate1 = r.lead ? ((r.phone / r.lead) * 100).toFixed(1) : "0.0";
    var rate2 = r.phone ? ((r.visit / r.phone) * 100).toFixed(1) : "0.0";

    return `
      <div class="marketing-funnel-card">
        <div class="marketing-funnel-title">${r.branch}</div>
        <div class="marketing-funnel-steps">
          <div class="marketing-funnel-step">
            <div class="label">Lead</div>
            <div class="value">${r.lead}</div>
          </div>
          <div class="marketing-funnel-arrow">‚ûú</div>
          <div class="marketing-funnel-step">
            <div class="label">SDT</div>
            <div class="value">${r.phone}</div>
          </div>
          <div class="marketing-funnel-arrow">‚ûú</div>
          <div class="marketing-funnel-step">
            <div class="label">Kh√°ch ƒë·∫øn</div>
            <div class="value">${r.visit}</div>
          </div>
        </div>
        <div class="marketing-funnel-rate">
          <span>Lead ‚Üí SDT: <b>${rate1}%</b></span>
          <span>SDT ‚Üí Kh√°ch: <b>${rate2}%</b></span>
        </div>
      </div>
    `;
  }).join("");
});
</script>

</body>
</html>
