<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kh√¥ng Gian Qu·∫£n Tr·ªã - An Nhi√™n 2026 (Premium)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Quicksand', 'sans-serif'],
                        sans: ['Nunito', 'sans-serif'],
                    },
                    colors: {
                        zen: {
                            bg: '#F7F5F2',
                            card: '#FAFAF8',
                            sage: '#8FAF9F',
                            tea: '#6B8F71',
                            dark: '#3F3F3F',
                            wood: '#CBBFA3',
                            gray: '#E5E5E5',
                            red: '#DFA7A7',
                            gold: '#D4AF37'
                        }
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F7F5F2; color: #3F3F3F; }
        
        /* Utils */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #E5E5E5; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #CBBFA3; }

        /* Sidebar Item */
        .sidebar-item { position: relative; transition: color 0.3s ease; z-index: 1; overflow: hidden; }
        .sidebar-item::before {
            content: ''; position: absolute; top: 0; left: 0; width: 0%; height: 100%;
            background-color: #FAFAF8; z-index: -1; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sidebar-item:hover::before { width: 100%; }
        .sidebar-item.active { color: #6B8F71; font-weight: 700; background-color: #FAFAF8; }
        .sidebar-item.active::after {
            content: ''; position: absolute; right: 0; top: 50%; transform: translateY(-50%);
            width: 4px; height: 20px; background-color: #6B8F71;
            border-top-left-radius: 4px; border-bottom-left-radius: 4px;
        }

        /* Animations */
        /* FIX: Opacity starts at 1 to prevent blank screen if JS errors occur */
        .reveal-on-scroll { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.5, 0, 0, 1); }
        .reveal-on-scroll.is-visible { opacity: 1; transform: translateY(0); }
        
        .progress-bar-bg { background-color: #F0F0F0; border-radius: 999px; overflow: hidden; height: 10px; }
        .progress-bar-fill { height: 100%; border-radius: 999px; width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); }

        /* Top 1 Card */
        .card-top-1 {
            border: 2px solid rgba(212, 175, 55, 0.3);
            background: linear-gradient(145deg, #fffcf5 0%, #ffffff 100%);
            box-shadow: 0 20px 25px -5px rgba(212, 175, 55, 0.15);
            transform: translateY(-4px); position: relative;
        }
        .card-top-1::before {
            content: 'üëë'; position: absolute; top: -15px; right: 20px; font-size: 24px;
            animation: float 3s ease-in-out infinite; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        .card-hover { transition: all 0.3s ease; will-change: transform, box-shadow; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.08); }

        /* Table Styling */
        .zen-table th { font-weight: 600; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; color: #9CA3AF; padding: 1rem; text-align: left; }
        .zen-table td { padding: 1rem; border-top: 1px solid #F3F4F6; color: #3F3F3F; font-size: 0.875rem; }
        .zen-table tr:hover td { background-color: #FAFAF8; }
    </style>
</head>
<body class="font-sans h-screen flex overflow-hidden text-zen-dark bg-zen-bg">

    <aside class="w-64 bg-white border-r border-zen-gray flex-col hidden md:flex z-20 shadow-sm relative">
        <div class="p-8 pb-4">
            <h1 class="font-display text-2xl font-bold text-zen-tea flex items-center gap-2">
                <i data-lucide="flower-2"></i> An Nhi√™n
            </h1>
            <p class="text-xs text-gray-400 mt-1 pl-8 tracking-wider">ECOSYSTEM 2026</p>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <div class="px-6 mb-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Th∆∞∆°ng Hi·ªáu</div>
            <a href="#" onclick="filterBrand('all')" class="sidebar-item active flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="layout-grid" class="w-4 h-4"></i> T·ªïng H·ª£p
            </a>
            <a href="#" onclick="filterBrand('AN NGUY√äN')" class="sidebar-item flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="sprout" class="w-4 h-4"></i> An Nguy√™n
            </a>
            <a href="#" onclick="filterBrand('AN NHI√äN')" class="sidebar-item flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="sun" class="w-4 h-4"></i> An Nhi√™n
            </a>
            <a href="#" onclick="filterBrand('PH·ª§C LINH')" class="sidebar-item flex items-center gap-3 px-8 py-3 text-sm rounded-r-xl mr-2">
                <i data-lucide="heart-pulse" class="w-4 h-4"></i> Ph·ª•c Linh
            </a>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden relative" id="main-scroll-container">
        
        <header id="main-header" class="bg-white/70 backdrop-blur-sm border-b border-zen-gray px-8 py-4 flex justify-between items-center z-10 sticky top-0 transition-all duration-300">
            <div>
                <h2 class="font-display text-xl font-bold" id="pageTitle">T·ªïng Quan Th√°ng <span id="displayMonth">1</span>/2026</h2>
                <p class="text-xs text-gray-400 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    D·ªØ li·ªáu th·ª±c t·∫ø [C·∫≠p nh·∫≠t 26/01]
                </p>
            </div>
            
            <div class="flex items-center gap-2 bg-zen-bg p-1 rounded-xl overflow-x-auto hide-scroll max-w-md border border-zen-gray/50">
                <button onclick="setMonth(1)" id="btn-m1" class="month-btn px-3 py-1 text-xs font-bold rounded-lg bg-zen-tea text-white shadow-sm transition-all">T1</button>
                <button onclick="setMonth(2)" id="btn-m2" class="month-btn px-3 py-1 text-xs font-bold rounded-lg text-gray-500 hover:bg-white hover:text-zen-tea transition-all">T2</button>
                <button onclick="setMonth(3)" id="btn-m3" class="month-btn px-3 py-1 text-xs font-bold rounded-lg text-gray-500 hover:bg-white hover:text-zen-tea transition-all">T3</button>
                <span class="text-gray-300 text-xs px-2">...</span>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8 custom-scroll scroll-smooth" id="scroll-body">
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 0ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">Doanh Thu Th·ª±c ƒê·∫°t</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-revenue">0</h3>
                        </div>
                        <div class="p-2 bg-zen-tea/10 rounded-lg text-zen-tea ring-1 ring-zen-tea/20">
                            <i data-lucide="banknote" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 100ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">T·ªïng L∆∞·ª£ng Kh√°ch</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-customers">0</h3>
                        </div>
                        <div class="p-2 bg-blue-100 rounded-lg text-blue-600 ring-1 ring-blue-600/20">
                            <i data-lucide="users" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 200ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">Chi Ph√≠ Ads</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-ads">0</h3>
                        </div>
                        <div class="p-2 bg-red-100 rounded-lg text-red-600 ring-1 ring-red-600/20">
                            <i data-lucide="megaphone" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray card-hover reveal-on-scroll" style="transition-delay: 300ms;">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-xs font-bold uppercase tracking-wide">Trung B√¨nh Bill</p>
                            <h3 class="text-2xl font-display font-bold mt-2 text-zen-dark" id="kpi-bill">0</h3>
                        </div>
                        <div class="p-2 bg-orange-100 rounded-lg text-orange-600 ring-1 ring-orange-600/20">
                            <i data-lucide="pie-chart" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="lg:col-span-2 bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray reveal-on-scroll group" style="transition-delay: 100ms;">
                    <h3 class="font-display font-bold text-lg text-zen-dark mb-6 flex items-center gap-2">
                        <i data-lucide="bar-chart-2" class="w-4 h-4 text-zen-tea"></i>
                        Bi·ªÉu ƒê·ªì Doanh Thu Ng√†y
                    </h3>
                    <div class="h-80 w-full relative transition-transform duration-700 ease-out transform group-hover:scale-[1.01]">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray flex flex-col reveal-on-scroll" style="transition-delay: 200ms;">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-display font-bold text-lg text-zen-dark">Ti·∫øn ƒê·ªô Target</h3>
                        <div class="bg-zen-bg p-2 rounded-full">
                            <i data-lucide="trophy" class="w-5 h-5 text-zen-gold"></i>
                        </div>
                    </div>
                    <div id="targetContainer" class="flex-1 space-y-5 overflow-y-auto pr-2 custom-scroll">
                        </div>
                </div>
            </div>

            <div class="mb-10">
                <div class="flex justify-between items-center mb-6 px-1 reveal-on-scroll">
                    <h3 class="font-display font-bold text-lg text-zen-dark flex items-center gap-2">
                        <i data-lucide="store" class="w-5 h-5 text-zen-dark"></i>
                        Chi Ti·∫øt Hi·ªáu Qu·∫£ Kinh Doanh
                    </h3>
                    <div class="flex gap-2">
                         <span class="text-xs text-zen-tea bg-white px-3 py-1 rounded-full border border-zen-tea font-bold shadow-sm">Th·ª±c ƒë·∫°t</span>
                         <span class="text-xs text-gray-400 bg-white px-3 py-1 rounded-full border border-zen-gray">Target</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="branchContainer">
                    </div>
            </div>

            <div class="mb-10 reveal-on-scroll">
                <div class="bg-zen-card p-6 rounded-2xl shadow-sm border border-zen-gray">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-display font-bold text-lg text-zen-dark flex items-center gap-2">
                            <i data-lucide="badge-dollar-sign" class="w-5 h-5 text-red-500"></i>
                            B·∫£ng Chi Ph√≠ Ads & Hi·ªáu Qu·∫£ (CIR)
                        </h3>
                        <span class="text-xs text-gray-400">D·ªØ li·ªáu Ads c·∫≠p nh·∫≠t theo file T·ªïng H·ª£p</span>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full zen-table">
                            <thead>
                                <tr>
                                    <th class="w-10"></th>
                                    <th>C∆° S·ªü</th>
                                    <th class="!text-right">Chi Ph√≠ Ads</th>
                                    <th class="!text-right">Doanh Thu</th>
                                    <th class="!text-right">CIR (%)</th>
                                    <th class="!text-right w-24">ƒê√°nh Gi√°</th>
                                </tr>
                            </thead>
                            <tbody id="adsTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="h-8"></div>
        </div>
    </main>

    <script>
        // --- 1. CSV RAW DATA (Daily Revenue) - UPDATED 26/01 ---
        // Cleaned data without headers to prevent JS errors
        const csvRaw = `
AN NGUY√äN,LONG BI√äN,2026-01-02,4,19800000
AN NGUY√äN,LONG BI√äN,2026-01-03,7,4600000
AN NGUY√äN,LONG BI√äN,2026-01-04,10,23900000
AN NGUY√äN,LONG BI√äN,2026-01-05,12,60300000
AN NGUY√äN,LONG BI√äN,2026-01-06,4,10199000
AN NGUY√äN,LONG BI√äN,2026-01-07,6,27300000
AN NGUY√äN,LONG BI√äN,2026-01-08,10,23200000
AN NGUY√äN,LONG BI√äN,2026-01-09,6,31400000
AN NGUY√äN,LONG BI√äN,2026-01-10,7,22600000
AN NGUY√äN,LONG BI√äN,2026-01-11,1,4800000
AN NGUY√äN,LONG BI√äN,2026-01-12,7,30400000
AN NGUY√äN,LONG BI√äN,2026-01-13,3,23500000
AN NGUY√äN,LONG BI√äN,2026-01-14,4,11600000
AN NGUY√äN,LONG BI√äN,2026-01-15,9,43100000
AN NGUY√äN,LONG BI√äN,2026-01-16,4,14500000
AN NGUY√äN,LONG BI√äN,2026-01-17,6,40400000
AN NGUY√äN,LONG BI√äN,2026-01-18,6,35400000
AN NGUY√äN,LONG BI√äN,2026-01-19,7,32100000
AN NGUY√äN,LONG BI√äN,2026-01-20,6,35200000
AN NGUY√äN,LONG BI√äN,2026-01-21,7,32500000
AN NGUY√äN,LONG BI√äN,2026-01-22,6,16000000
AN NGUY√äN,LONG BI√äN,2026-01-23,2,4499000
AN NGUY√äN,LONG BI√äN,2026-01-24,4,11300000
AN NGUY√äN,LONG BI√äN,2026-01-25,2,600000
AN NGUY√äN,LONG BI√äN,2026-01-26,6,7700000
AN NHI√äN ,CMT8,2026-01-02,3,7000000
AN NHI√äN ,CMT8,2026-01-03,3,11900000
AN NHI√äN ,CMT8,2026-01-04,5,9500000
AN NHI√äN ,CMT8,2026-01-05,4,16900000
AN NHI√äN ,CMT8,2026-01-06,3,1500000
AN NHI√äN ,CMT8,2026-01-07,1,6100000
AN NHI√äN ,CMT8,2026-01-08,5,28000000
AN NHI√äN ,CMT8,2026-01-09,3,10000000
AN NHI√äN ,CMT8,2026-01-10,3,3000000
AN NHI√äN ,CMT8,2026-01-11,0,0
AN NHI√äN ,CMT8,2026-01-12,4,3000000
AN NHI√äN ,CMT8,2026-01-13,3,3500000
AN NHI√äN ,CMT8,2026-01-14,2,8000000
AN NHI√äN ,CMT8,2026-01-15,2,1000000
AN NHI√äN ,CMT8,2026-01-16,2,1000000
AN NHI√äN ,CMT8,2026-01-17,6,5800000
AN NHI√äN ,CMT8,2026-01-18,0,800000
AN NHI√äN ,CMT8,2026-01-19,2,7800000
AN NHI√äN ,CMT8,2026-01-20,4,12500000
AN NHI√äN ,CMT8,2026-01-21,0,0
AN NHI√äN ,CMT8,2026-01-22,4,5000000
AN NHI√äN ,CMT8,2026-01-23,1,1000000
AN NHI√äN ,CMT8,2026-01-24,3,3600000
AN NHI√äN ,CMT8,2026-01-25,1,5500000
AN NHI√äN ,ADV,2026-01-02,3,13900000
AN NHI√äN ,ADV,2026-01-03,2,6500000
AN NHI√äN ,ADV,2026-01-04,4,13000000
AN NHI√äN ,ADV,2026-01-05,4,4800000
AN NHI√äN ,ADV,2026-01-06,3,6600000
AN NHI√äN ,ADV,2026-01-07,1,5200000
AN NHI√äN ,ADV,2026-01-08,3,2800000
AN NHI√äN ,ADV,2026-01-09,2,15100000
AN NHI√äN ,ADV,2026-01-10,1,2500000
AN NHI√äN ,ADV,2026-01-11,5,10800000
AN NHI√äN ,ADV,2026-01-12,4,14000000
AN NHI√äN ,ADV,2026-01-13,2,1000000
AN NHI√äN ,ADV,2026-01-14,9,14500000
AN NHI√äN ,ADV,2026-01-15,2,3500000
AN NHI√äN ,ADV,2026-01-16,3,10500000
AN NHI√äN ,ADV,2026-01-17,4,15800000
AN NHI√äN ,ADV,2026-01-18,5,8200000
AN NHI√äN ,ADV,2026-01-19,4,10800000
AN NHI√äN ,ADV,2026-01-20,1,4000000
AN NHI√äN ,ADV,2026-01-21,3,13600000
AN NHI√äN ,ADV,2026-01-22,7,9100000
AN NHI√äN ,ADV,2026-01-23,6,1900000
AN NHI√äN ,ADV,2026-01-24,3,6300000
AN NHI√äN ,ADV,2026-01-25,3,3000000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-02,3,35500000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-03,9,39699000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-04,14,80800000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-05,10,40150000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-06,3,10000000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-07,6,15800000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-08,8,40260000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-09,11,71300000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-10,7,88440000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-11,8,14299000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-12,2,21460000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-13,9,40700000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-14,7,101000000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-15,7,9700000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-16,8,22300000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-17,7,45100000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-18,7,34700000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-19,9,42579000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-20,6,55300000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-21,2,32100000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-22,1,26300000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-23,7,15500000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-24,6,22160000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-25,5,17100000
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-26,6,23800000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-02,3,12000000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-03,8,33000000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-04,9,42700000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-05,6,15600000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-06,8,35200000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-07,4,22500000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-08,7,13020000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-09,4,34700000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-10,5,60100000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-11,6,60200000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-12,8,24880000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-13,6,35049000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-14,6,50000000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-15,10,21100000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-16,5,31200000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-17,8,58600000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-18,12,60799000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-19,6,36100000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-20,7,53500000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-21,7,104299999
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-22,5,4700000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-23,5,4498000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-24,8,25600000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-25,10,49190000
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-26,5,20210000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-02,7,21300000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-03,4,19200000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-04,8,9200000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-05,8,13799000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-06,2,30600000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-07,8,33200000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-08,13,41600000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-09,8,7300000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-10,8,14699000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-11,6,45100000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-12,7,23800000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-13,1,6660000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-14,9,30300000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-15,8,26600000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-16,6,19900000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-17,11,53200000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-18,10,46460000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-19,3,38400000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-20,2,24100000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-21,8,22000000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-22,3,42700000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-23,5,3700000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-24,6,31600000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-25,6,47400000
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-26,8,14300000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-02,2,3600000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-03,7,13500000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-04,12,28600000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-05,5,14200000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-06,5,18600000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-07,5,18100000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-08,2,5600000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-09,5,9700000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-10,15,22800000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-11,6,17100000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-12,2,6550000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-13,6,18800000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-14,8,17700000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-15,5,7800000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-16,3,2100000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-17,5,11300000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-18,4,29150000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-19,4,3000000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-20,3,6000000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-21,4,12700000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-22,0,5000000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-23,4,11250000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-24,5,13400000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-25,5,18440000
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-26,8,4500000
`;

        // --- 2. CSV RAW DATA (Ads Cost) - UPDATED 26/01 ---
        // Manually mapped from "T·ªïng h·ª£p.xlsx"
        const csvAdsRaw = `
AN NGUY√äN,LONG BI√äN,2026-01-31,97525116
AN NHI√äN,ADV,2026-01-31,85305714
AN NHI√äN,CMT8,2026-01-31,45810482
PH·ª§C LINH,C·∫¶U GI·∫§Y,2026-01-31,2170365
PH·ª§C LINH,H√Ä ƒê√îNG,2026-01-31,2120984
PH·ª§C LINH,H·∫¢I PH√íNG,2026-01-31,2155534
PH·ª§C LINH,X√É ƒê√ÄN,2026-01-31,4873241
`;

        // --- 3. SUMMARY TARGETS - UPDATED 26/01 ---
        const summaryData = [
            { brand: 'AN NGUY√äN', branch: 'LONG BI√äN',  target: 700000000 },
            { brand: 'AN NHI√äN',  branch: 'CMT8',       target: 500000000 },
            { brand: 'AN NHI√äN',  branch: 'ADV',        target: 500000000 },
            { brand: 'PH·ª§C LINH', branch: 'X√É ƒê√ÄN',     target: 1080000000 },
            { brand: 'PH·ª§C LINH', branch: 'C·∫¶U GI·∫§Y',   target: 880000000 },
            { brand: 'PH·ª§C LINH', branch: 'H√Ä ƒê√îNG',    target: 820000000 },
            { brand: 'PH·ª§C LINH', branch: 'H·∫¢I PH√íNG',  target: 500000000 }
        ];

        // --- GLOBAL STATE ---
        let currentMonth = 1; 
        let currentBrand = 'all';
        let parsedDailyData = [];
        let parsedAdsData = [];
        let chartInstances = {};
        
        // --- OBSERVER ---
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    const progressBars = entry.target.querySelectorAll('.progress-bar-fill');
                    progressBars.forEach(bar => {
                        const targetWidth = bar.getAttribute('data-width');
                        setTimeout(() => { bar.style.width = targetWidth + '%'; }, 200);
                    });
                    revealObserver.unobserve(entry.target);
                }
            });
        }, { root: document.getElementById('scroll-body'), threshold: 0.1 });

        // Header Scroll
        document.getElementById('scroll-body').addEventListener('scroll', function() {
            const header = document.getElementById('main-header');
            if (this.scrollTop > 20) {
                header.classList.add('bg-white/90', 'backdrop-blur-md', 'shadow-sm');
                header.classList.remove('bg-white/70', 'backdrop-blur-sm');
            } else {
                header.classList.add('bg-white/70', 'backdrop-blur-sm');
                header.classList.remove('bg-white/90', 'backdrop-blur-md', 'shadow-sm');
            }
        });

        // --- PARSERS ---
        function parseCSV(raw, type) {
            const lines = raw.trim().split('\n');
            const data = [];
            lines.forEach(line => {
                const cols = line.split(',');
                if(cols.length < 3) return;
                const brand = cols[0].trim();
                const branch = cols[1].trim();
                const dateStr = cols[2].trim();
                if(dateStr.startsWith('2026')) {
                    const val = parseFloat(cols[3]) || 0;
                    data.push({
                        brand, branch, date: dateStr,
                        month: parseInt(dateStr.split('-')[1]),
                        day: parseInt(dateStr.split('-')[2]),
                        value1: val, // Cust or Ads
                        value2: parseFloat(cols[4]) || 0 // Rev or 0
                    });
                }
            });
            return data;
        }

        function setMonth(m) {
            currentMonth = m;
            document.querySelectorAll('.month-btn').forEach((btn, idx) => {
                const monthId = idx + 1;
                if(monthId === m) {
                    btn.classList.remove('bg-white', 'text-gray-500', 'hover:bg-white', 'hover:text-zen-tea');
                    btn.classList.add('bg-zen-tea', 'text-white');
                } else {
                    btn.classList.add('bg-white', 'text-gray-500', 'hover:bg-white', 'hover:text-zen-tea');
                    btn.classList.remove('bg-zen-tea', 'text-white');
                }
            });
            updateDashboard();
        }

        function filterBrand(brand) {
            currentBrand = brand;
            document.querySelectorAll('.sidebar-item').forEach(el => {
                const onclickVal = el.getAttribute('onclick');
                if(onclickVal && onclickVal.includes(`'${brand}'`)) el.classList.add('active');
                else el.classList.remove('active');
            });
            updateDashboard();
        }

        // --- MAIN LOGIC ---
        function updateDashboard() {
            // 1. Filter Data
            let dailyRev = parsedDailyData.filter(d => d.month === currentMonth);
            let dailyAds = parsedAdsData.filter(d => d.month === currentMonth);

            if (currentBrand !== 'all') {
                dailyRev = dailyRev.filter(d => d.brand === currentBrand);
                dailyAds = dailyAds.filter(d => d.brand === currentBrand);
            }

            // 2. Aggregate Data by Branch
            const branchMap = {};

            // Init from summary (Targets)
            let filteredSummary = summaryData;
            if (currentBrand !== 'all') filteredSummary = summaryData.filter(d => d.brand === currentBrand);
            
            filteredSummary.forEach(s => {
                branchMap[s.branch] = { 
                    brand: s.brand, 
                    branch: s.branch, 
                    target: s.target, 
                    revenue: 0, 
                    customers: 0, 
                    ads: 0 
                };
            });

            // Fill Revenue & Cust
            dailyRev.forEach(d => {
                if(branchMap[d.branch]) {
                    branchMap[d.branch].revenue += d.value2; // col 4 is rev
                    branchMap[d.branch].customers += d.value1; // col 3 is cust
                }
            });

            // Fill Ads
            dailyAds.forEach(d => {
                if(branchMap[d.branch]) {
                    branchMap[d.branch].ads += d.value1; // col 3 is ads in ads csv
                }
            });

            const aggregatedData = Object.values(branchMap);

            // 3. Totals
            const totalRevenue = aggregatedData.reduce((sum, d) => sum + d.revenue, 0);
            const totalCustomers = aggregatedData.reduce((sum, d) => sum + d.customers, 0);
            const totalAds = aggregatedData.reduce((sum, d) => sum + d.ads, 0);
            const avgBill = totalCustomers > 0 ? Math.round(totalRevenue / totalCustomers) : 0;

            // 4. Update KPIs
            animateValue("kpi-revenue", parseInt(document.getElementById('kpi-revenue').innerText.replace(/\D/g,'')) || 0, totalRevenue, 1000);
            animateValue("kpi-customers", parseInt(document.getElementById('kpi-customers').innerText.replace(/\D/g,'')) || 0, totalCustomers, 1000);
            animateValue("kpi-ads", parseInt(document.getElementById('kpi-ads').innerText.replace(/\D/g,'')) || 0, totalAds, 1000);
            animateValue("kpi-bill", parseInt(document.getElementById('kpi-bill').innerText.replace(/\D/g,'')) || 0, avgBill, 1000);

            // 5. Render All
            renderMainChart(dailyRev);
            renderTargetProgress(aggregatedData);
            renderBranchCards(aggregatedData);
            renderAdsTable(aggregatedData); // New
            
            setTimeout(() => {
                document.querySelectorAll('.reveal-on-scroll').forEach(el => revealObserver.observe(el));
                lucide.createIcons();
            }, 100);
        }

        function animateValue(id, start, end, duration) {
            if (start === end) return;
            const obj = document.getElementById(id);
            const range = end - start;
            let current = start;
            const stepTime = Math.abs(Math.floor(duration / (range / (range > 100 ? 100 : 1))));
            const steps = 20; const stepVal = range / steps;
            let stepCount = 0;
            const timer = setInterval(function() {
                stepCount++; current += stepVal;
                obj.innerText = new Intl.NumberFormat('vi-VN').format(Math.round(current));
                if (stepCount >= steps) { obj.innerText = new Intl.NumberFormat('vi-VN').format(end); clearInterval(timer); }
            }, duration / steps);
        }

        // --- RENDERERS ---

        function renderTargetProgress(data) {
            const container = document.getElementById('targetContainer');
            container.innerHTML = '';
            if(data.length === 0) { container.innerHTML = '<p class="text-sm text-gray-400 text-center mt-10">Ch∆∞a c√≥ d·ªØ li·ªáu</p>'; return; }
            const sorted = [...data].sort((a, b) => (b.revenue/b.target) - (a.revenue/a.target));
            sorted.forEach((item, index) => {
                const percent = item.target > 0 ? (item.revenue / item.target) * 100 : 0;
                let barWidth = percent > 100 ? 100 : percent;
                let barColor = 'bg-zen-tea';
                if(percent < 30) barColor = 'bg-red-400'; else if(percent < 70) barColor = 'bg-orange-400'; if(percent >= 100) barColor = 'bg-green-500';
                
                const isTop1 = index === 0;
                const topIndicator = isTop1 ? '<span class="ml-2 text-xs text-yellow-500 animate-pulse">üëë Top 1</span>' : '';
                const nameStyle = isTop1 ? 'font-bold text-zen-tea' : 'text-zen-dark';
                const div = document.createElement('div');
                div.className = `reveal-on-scroll`; div.style.transitionDelay = `${index * 100}ms`;
                const formatShort = (n) => { if(n >= 1000000000) return (n/1000000000).toFixed(1) + ' t·ª∑'; if(n >= 1000000) return (n/1000000).toFixed(0) + 'tr'; return new Intl.NumberFormat('vi-VN').format(n); }
                div.innerHTML = `
                    <div class="flex justify-between items-end mb-1">
                        <div><span class="text-sm ${nameStyle} block flex items-center">${index + 1}. ${item.branch} ${topIndicator}</span></div>
                        <div class="text-right"><span class="text-xs font-bold ${percent >= 100 ? 'text-green-600' : 'text-gray-500'}">${percent.toFixed(1)}%</span></div>
                    </div>
                    <div class="progress-bar-bg relative mb-1 w-full bg-gray-100">
                        <div class="progress-bar-fill ${barColor} shadow-sm" style="width: 0%" data-width="${barWidth}"></div>
                    </div>
                    <div class="flex justify-between text-[10px] text-gray-400"><span>${formatShort(item.revenue)}</span><span>MT: ${formatShort(item.target)}</span></div>
                `;
                container.appendChild(div);
            });
        }

        function renderBranchCards(data) {
            const container = document.getElementById('branchContainer');
            container.innerHTML = '';
            const sorted = [...data].sort((a,b) => b.revenue - a.revenue);
            if (sorted.length === 0) { container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-4">Ch∆∞a c√≥ d·ªØ li·ªáu.</p>'; return; }
            sorted.forEach((item, idx) => {
                const percent = item.target > 0 ? (item.revenue / item.target) * 100 : 0;
                const isTop1 = idx === 0;
                const card = document.createElement('div');
                const baseClasses = "bg-zen-card p-5 rounded-xl border flex flex-col justify-between reveal-on-scroll";
                const borderClass = isTop1 ? "card-top-1 z-10" : "border-zen-gray card-hover shadow-sm";
                card.className = `${baseClasses} ${borderClass}`; card.style.transitionDelay = `${idx * 150}ms`;
                let brandColor = 'text-zen-tea'; let brandBg = 'bg-zen-sage/20';
                if(item.brand === 'AN NHI√äN') { brandColor = 'text-orange-600'; brandBg = 'bg-orange-100'; }
                if(item.brand === 'PH·ª§C LINH') { brandColor = 'text-blue-600'; brandBg = 'bg-blue-100'; }
                card.innerHTML = `
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-zen-dark text-lg ${isTop1 ? 'text-yellow-600' : ''}">${item.branch}</h4>
                            <span class="text-[10px] font-bold ${brandColor} ${brandBg} px-2 py-1 rounded-md uppercase tracking-wide">${item.brand}</span>
                        </div>
                        <div class="flex flex-col gap-1 mb-2">
                             <div class="flex justify-between items-baseline"><span class="text-gray-400 text-xs">Doanh thu</span><span class="text-xl font-bold text-zen-dark">${new Intl.NumberFormat('vi-VN').format(item.revenue)}</span></div>
                             ${item.target > 0 ? `<div class="flex justify-between items-baseline"><span class="text-gray-400 text-xs">Target</span><span class="text-xs font-bold text-gray-500">${new Intl.NumberFormat('vi-VN').format(item.target)}</span></div>` : ''}
                        </div>
                    </div>
                    ${item.target > 0 ? `<div class="mt-2 pt-2 border-t border-gray-100"><div class="w-full bg-gray-200 rounded-full h-1.5 mb-2 overflow-hidden"><div class="progress-bar-fill ${isTop1 ? 'bg-yellow-500' : 'bg-zen-tea'} h-1.5 rounded-full" style="width: 0%" data-width="${Math.min(percent, 100)}"></div></div><div class="flex justify-between items-center text-xs"><span class="${percent >= 100 ? 'text-green-600' : 'text-gray-500'} font-bold">ƒê·∫°t ${percent.toFixed(1)}%</span><div class="flex items-center text-gray-500"><i data-lucide="users" class="w-3 h-3 mr-1"></i> ${item.customers}</div></div></div>` : ''}
                `;
                container.appendChild(card);
            });
        }

        function renderAdsTable(data) {
            const tbody = document.getElementById('adsTableBody');
            tbody.innerHTML = '';
            // Sort by ads spend desc
            const sorted = [...data].sort((a, b) => b.ads - a.ads);
            
            sorted.forEach(item => {
                if(item.ads === 0 && item.revenue === 0) return; // Skip empty rows

                const tr = document.createElement('tr');
                const cir = item.revenue > 0 ? (item.ads / item.revenue) * 100 : 0;
                
                let brandIcon = 'sprout';
                let brandColor = 'text-zen-tea';
                if(item.brand === 'AN NHI√äN') { brandIcon = 'sun'; brandColor = 'text-orange-500'; }
                if(item.brand === 'PH·ª§C LINH') { brandIcon = 'heart-pulse'; brandColor = 'text-blue-500'; }

                let cirClass = 'text-zen-dark';
                let cirBadge = '<span class="px-2 py-1 rounded bg-gray-100 text-gray-500 text-xs font-bold">·ªîn ƒë·ªãnh</span>';
                
                if(cir > 20) {
                    cirClass = 'text-red-500 font-bold';
                    cirBadge = '<span class="px-2 py-1 rounded bg-red-100 text-red-600 text-xs font-bold">Cao</span>';
                } else if(cir < 10 && cir > 0) {
                    cirClass = 'text-green-600 font-bold';
                    cirBadge = '<span class="px-2 py-1 rounded bg-green-100 text-green-600 text-xs font-bold">T·ªët</span>';
                }

                tr.innerHTML = `
                    <td><i data-lucide="${brandIcon}" class="w-4 h-4 ${brandColor}"></i></td>
                    <td class="font-bold text-zen-dark">${item.branch}</td>
                    <td class="text-right font-mono">${new Intl.NumberFormat('vi-VN').format(item.ads)}</td>
                    <td class="text-right text-gray-500">${new Intl.NumberFormat('vi-VN').format(item.revenue)}</td>
                    <td class="text-right ${cirClass}">${cir.toFixed(2)}%</td>
                    <td class="text-right">${cirBadge}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderMainChart(dailyData) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const daysInMonth = new Date(2026, currentMonth, 0).getDate();
            const labels = Array.from({length: daysInMonth}, (_, i) => i + 1);
            const revData = new Array(daysInMonth).fill(0);
            const custData = new Array(daysInMonth).fill(0);
            dailyData.forEach(d => { revData[d.day - 1] += d.value2; custData[d.day - 1] += d.value1; });
            if(chartInstances.main) chartInstances.main.destroy();
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(107, 143, 113, 0.4)'); gradient.addColorStop(1, 'rgba(107, 143, 113, 0.0)');
            chartInstances.main = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Doanh Thu Ng√†y', data: revData, type: 'line', borderColor: '#6B8F71', backgroundColor: gradient, borderWidth: 2, tension: 0.4, fill: true, yAxisID: 'y', pointRadius: 0, pointHoverRadius: 6, pointBackgroundColor: '#6B8F71' },
                        { label: 'L∆∞·ª£ng Kh√°ch', data: custData, type: 'bar', backgroundColor: 'rgba(203, 191, 163, 0.5)', hoverBackgroundColor: '#CBBFA3', borderRadius: 2, yAxisID: 'y1' }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, animation: { duration: 2000, easing: 'easeOutQuart' }, interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { display: true, position: 'top', align: 'end', labels: { boxWidth: 10, usePointStyle: true, font: {size: 11, family: 'Nunito'} } },
                        tooltip: { backgroundColor: 'rgba(255, 255, 255, 0.95)', titleColor: '#3F3F3F', bodyColor: '#3F3F3F', borderColor: '#E5E5E5', borderWidth: 1, padding: 10, displayColors: true, callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.parsed.y !== null) { if(context.dataset.type === 'line') { label += new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(context.parsed.y); } else { label += context.parsed.y; } } return label; } } }
                    },
                    scales: { x: { grid: { display: false }, ticks: { font: {size: 10} } }, y: { type: 'linear', display: true, position: 'left', grid: { borderDash: [4, 4], color: '#f0f0f0' }, ticks: { callback: v => v/1000000 + 'M', font: {size: 10} } }, y1: { display: false } }
                }
            });
        }

        window.onload = function() {
            lucide.createIcons();
            parsedDailyData = parseCSV(csvRaw, 'rev'); 
            parsedAdsData = parseCSV(csvAdsRaw, 'ads');
            setMonth(1); 
        };
    </script>
</body>
</html>
